{"version":3,"sources":["scripts/main.js"],"names":["this","MyOD","Backbone","Marionette","Application","on","searchModel","Models","SearchModel","layout","Main","Layout","history","setClasses","start","pushState","root","navigate","trigger","route","options","search","getRoute","navigateDataset","datasetId","navigate404","replace","queryStringToObject","result","q","getFragment","split","pairs","_","each","pair","decodeURIComponent","getBloodhound","bloodhound","Bloodhound","datumTokenizer","tokenizers","obj","whitespace","queryTokenizer","limit","remote","url","config","api","rateLimitWait","query","filter","response","data","onBeforeDestroy","stop","esri","module","Utils","App","$","MapManager","Object","extend","initialize","globalChannel","Wreqr","radio","channel","_loadDojo","dfd","Deferred","dojoReady","promise","window","dojo","resolve","include","require","Map","MapView","FeatureLayer","PopupTemplate","SpatialReference","Extent","SimpleRenderer","map","destroy","proxyEvent","evtName","evt","vent","createMap","mapDiv","mapOpts","basemap","extent","$mapDiv","mapViewOpts","container","height","width","coords","wkid","center","zoom","mapView","hitch","getDatasetInfoTemplate","dataset","displayFieldName","get","title","description","getDatasetLayerOpts","opts","minScale","maxScale","outFields","popupTemplate","renderer","getRenderer","addDataset","datasetLayer","add","geometryType","_createRendererFromJson","util","defaults","defaultPolygonRenderer","defaultPointRenderer","defaultLineRenderer","rendererJson","xmin","ymin","xmax","ymax","spatialReference","serviceUrls","geometryService","type","label","symbol","color","size","angle","xoffset","yoffset","style","outline","Base","SearchView","ItemView","onRender","initTypeahead","highlight","minLength","hint","datasets","name","displayKey","item","templates","empty","source","ttAdapter","ui","typeahead","onTypeaheadSelected","model","set","page","updateModel","onKeyDown","e","which","preventDefault","onKeyUp","onSearchButtonClick","Model","per_page","totalCount","queryStringParams","getQueryString","pick","toJSON","number","param","getUrl","JST","datasets/templates/dataset","__t","__p","escape","moment","createdAt","calendar","updatedAt","tags","join","datasets/templates/table-row","Array","prototype","fields","field","attributes","datasets/templates/table","from","toLocaleString","to","total","sortField","alias","pages","length","error/templates/404","error/templates/500","home/templates/home","results/templates/results-empty","results/templates/results-item","fromNow","results/templates/results-loading","results/templates/results","collectionIsLoading","HeaderSearchView","listenTo","onQueryChanged","el","template","events","keydown #header-search","keyup #header-search","click #header-search-btn","typeahead:selected input","LayoutView","bindAll","headerSearchView","render","regions","main","click #home-link","navigateHome","metaKey","ctrlKey","self","indexOf","$el","removeClass","addClass","HomeModule","View","keydown #search","keyup #search","click #search-btn","id","onDomRefresh","focus","Controller","initUi","view","getRegion","show","Router","AppRouter","appRoutes","addInitializer","controller","API","homeController","DatasetModel","landingPage","recordCount","itemType","owner","views","thumbnailUrl","parse","resp","getNumericFields","contains","DatasetCollection","Collection","meta","queryParameters","stats","ResultsModule","tagName","click","onClick","LoadingView","className","EmptyView","CompositeView","selectDataset","childView","childViewContainer","getEmptyView","click ul.pagination a","modelEvents","change:totalCount","collectionEvents","sync","error","onCollectionSync","childModel","onPageClicked","stopPropagation","target","closest","templateHelpers","active","info","len","Math","round","total_pages","ceil","end","clone","i","push","prevUrl","prevPage","nextUrl","nextPage","firstPage","lastPage","collection","fetch","cache","datasets(/)","queryObj","resultsController","DatasetRow","RowCollection","queryCapabilities","supportsPagination","orderBy","perPage","orderByAsc","getQueryUrl","rows","features","first","DatasetsModule","TableRowView","TableView","click ul.pagination li a","click thead th","reset","childViewOptions","showPagination","sortClass","sortIconClass","totalPages","anchor","li","hasClass","sort","mapManager","tableContainer","change","baseUrl","defaultThumbnailUrl","thumbnailSrc","tableView","toLowerCase","done","coordinates","initSmaps","numerics","fieldName","getStats","getGeometryType","yukiOptions","statistics","schemes","getSchemes","yuki","remove","Yuki","changeAttribute","changeRamp","_execStyleMap","fieldObj","findWhere","geomType","theme","styleType","styles","selectedScheme","index","secondarySchemes","scheme","reqres","request","buildPointLegend","breaks","onDestroy","onModelFetched","fail","datasets/:id(/)","datasetsController","ErrorModule","getTemplate","errorCode","404","500","initController","errorController","error404","error500"],"mappings":"AAEKA,KAAKC,MAA6B,gBAAdD,MAAKC,OAC5BD,KAAKC,SAGP,WACE,YAEAA,MAAO,GAAIC,UAASC,WAAWC,YAE/BH,KAAKI,GAAG,eAAgB,WACtBL,KAAKM,YAAc,GAAIL,MAAKM,OAAOC,YACnCR,KAAKS,OAAS,GAAIR,MAAKS,KAAKC,SAI9BV,KAAKI,GAAG,QAAS,WACfH,SAASU,QAAQP,GAAG,QAASL,KAAKS,OAAOI,YAErCX,SAASU,UAKNV,SAASU,QAAQE,OAAQC,WAAW,EAAOC,KAAM,wBACpDf,KAAKgB,SAAS,OAASC,SAAQ,OAKrCjB,KAAKgB,SAAW,SAAUE,EAAOC,GAC/BlB,SAASU,QAAQK,SAASE,EAAOC,IAGnCnB,KAAKoB,OAAS,WACZ,GAAIF,GAAQlB,KAAKK,YAAYgB,UAC7BrB,MAAKgB,SAASE,GAASD,SAAS,KAGlCjB,KAAKsB,gBAAkB,SAAUC,GAC/BvB,KAAKgB,SAAS,aAAeO,GAAaN,SAAS,KAGrDjB,KAAKwB,YAAc,WACjBxB,KAAKgB,SAAS,OAASC,SAAS,EAAMQ,SAAS,KAGjDzB,KAAK0B,oBAAsB,WACzB,GAAIC,MAEAC,EAAI3B,SAASU,QAAQkB,cAAcC,MAAM,KAAK,EAElD,IAAIF,EAAG,CACL,GAAIG,GAAQH,EAAEE,MAAM,IAEpBE,GAAEC,KAAKF,EAAO,SAASG,GACrBA,EAAOA,EAAKJ,MAAM,KAEhBH,EAAOO,EAAK,IADE,MAAZA,EAAK,GACWA,EAAK,GAAGT,QAAQ,MAAO,MAAQ,GAE/BU,mBAAmBD,EAAK,IAAM,MAKtD,MAAOP,IAKT3B,KAAKoC,cAAgB,WAkBnB,MAjBKrC,MAAKsC,aACRtC,KAAKsC,WAAa,GAAIC,aACpBC,eAAgBD,WAAWE,WAAWC,IAAIC,WAAW,SACrDC,eAAgBL,WAAWE,WAAWE,WACtCE,MAAO,GACPC,QACEC,IAAK9C,KAAK+C,OAAOC,IAAIvB,QAAQ,UAAW,IAAM,0CAC9CwB,cAAe,IACfxB,QAAS,SAAUqB,EAAKI,GACtB,MAAOJ,GAAIrB,QAAQ,SAAUyB,IAE/BC,OAAQ,SAASC,GACf,MAAOA,GAAWA,EAASC,aAK5BtD,KAAKsC,YAGdrC,KAAKsD,gBAAkB,WACrBrD,SAASU,QAAQ4C,WAKrB,WAEE,YAGA,IAAIC,KAEJxD,MAAKyD,OAAO,QAAS,SAAUC,EAAOC,EAAK1D,EAAUC,EAAY0D,GAE/DF,EAAMG,WAAa3D,EAAW4D,OAAOC,QAEnCC,WAAY,WACVjE,KAAKkE,cAAgBhE,EAASiE,MAAMC,MAAMC,QAAQ,UAElDrE,KAAKsE,aAMPA,UAAW,WACT,GAAIC,GAAMV,EAAEW,UACZxE,MAAKyE,UAAYF,EAAIG,UAEhBC,OAAOC,KA4BVL,EAAIM,UA1BJC,QAAQ,4BAA6B,WAEnCC,SACE,WACA,qBACA,2BACA,6BACA,iCACA,uBACA,gCACA,kBACC,SAASC,EAAKC,EAASC,EAAcC,EAAeC,EAAkBC,EAAQC,GAC/E7B,EAAKuB,IAAMA,EACXvB,EAAKwB,QAAUA,EACfxB,EAAKyB,aAAeA,EACpBzB,EAAK0B,cAAgBA,EACrB1B,EAAK2B,iBAAmBA,EACxB3B,EAAK4B,OAASA,EACd5B,EAAK6B,eAAiBA,EAEtBf,EAAIM,eAUZtB,gBAAiB,WACXvD,KAAKuF,KACPvF,KAAKuF,IAAIC,WAIbC,WAAY,SAAUC,EAASC,GAC7B3F,KAAKkE,cAAc0B,KAAK1E,QAAQwE,EAASC,IAK3CE,UAAW,SAAUC,EAAQ1E,GAC3B,GAAI2E,IACFC,QAAS,YAGXhG,MAAKuF,IAAM,GAAI9B,GAAKuB,IAAIe,EAExB,IASIE,GATAC,EAAUrC,EAAE,QAEZsC,GACFC,UAAW,MACXb,IAAKvF,KAAKuF,IACVc,OAAQH,EAAQG,SAChBC,MAAOJ,EAAQI,QAIblF,GAAQmF,SACVN,EAAS,GAAIxC,GAAK4B,OAAOjE,EAAQmF,OAAO,GAAG,GAAInF,EAAQmF,OAAO,GAAG,GAAInF,EAAQmF,OAAO,GAAG,GAAInF,EAAQmF,OAAO,GAAG,GAAI,GAAI9C,GAAK2B,kBAAmBoB,KAAM,SAGjJP,EACFE,EAAYF,OAASA,GAErBE,EAAYM,QAAW,QAAS,QAChCN,EAAYO,KAAO,GAGrB1G,KAAK2G,QAAU,GAAIlD,GAAKwB,QAAQkB,GAGhCnG,KAAKuF,IAAIlF,GAAG,OAAQuE,KAAKgC,MAAM5G,KAAMA,KAAKyF,WAAY,aACtDzF,KAAKuF,IAAIlF,GAAG,gBAAiBuE,KAAKgC,MAAM5G,KAAMA,KAAKyF,WAAY,sBAC/DzF,KAAKuF,IAAIlF,GAAG,YAAauE,KAAKgC,MAAM5G,KAAMA,KAAKyF,WAAY,mBAG7DoB,uBAAwB,SAAUC,GAChC,GAAIC,GAAmBD,EAAQE,IAAI,gBAC/BC,EAAQF,EAAmB,IAAMA,EAAmB,IAAM,YAC9D,OAAO,IAAItD,GAAK0B,eAAgB8B,MAAOA,EAAOC,YAAa,SAG7DC,oBAAqB,SAAUL,GAC7B,GAAIM,IACFC,SAAU,EACVC,SAAU,EACVC,WAAY,KACZC,cAAexH,KAAK6G,uBAAuBC,GAC3CW,SAAUzH,KAAK0H,YAAYZ,GAG7B,OAAOM,IAGTO,WAAY,SAAUb,GACpB,GAAIM,GAAOpH,KAAKmH,oBAAoBL,EACpC9G,MAAK4H,aAAe,GAAInE,GAAKyB,aAAa4B,EAAQE,IAAI,OAAQI,GAG9DpH,KAAK4H,aAAavH,GAAG,OAAQuE,KAAKgC,MAAM5G,KAAMA,KAAKyF,WAAY,0BAC/DzF,KAAK4H,aAAavH,GAAG,QAASuE,KAAKgC,MAAM5G,KAAMA,KAAKyF,WAAY,2BAChEzF,KAAK4H,aAAavH,GAAG,uBAAwBuE,KAAKgC,MAAM5G,KAAMA,KAAKyF,WAAY,0CAC/EzF,KAAK4H,aAAavH,GAAG,aAAcuE,KAAKgC,MAAM5G,KAAMA,KAAKyF,WAAY,gCAErEzF,KAAKuF,IAAIsC,IAAI7H,KAAK4H,eAUpBF,YAAa,SAASZ,GAClB,GACIW,GADAK,EAAehB,EAAQE,IAAI,eAG/B,QAAQc,GACJ,IAAK,sBACDL,EAAWzH,KAAK+H,wBAAwBC,KAAKC,SAASC,uBACtD,MACJ,KAAK,oBACDT,EAAWzH,KAAK+H,wBAAwBC,KAAKC,SAASE,qBACtD,MACJ,KAAK,yBACDV,EAAWzH,KAAK+H,wBAAwBC,KAAKC,SAASE,qBACtD,MACJ,KAAK,uBACDV,EAAWzH,KAAK+H,wBAAwBC,KAAKC,SAASG,oBACtD,MACJ,KAAK,mBACDX,EAAWzH,KAAK+H,wBAAwBC,KAAKC,SAASG,oBACtD,MACJ,SACIX,EAAWzH,KAAK+H,wBAAwBC,KAAKC,SAASC,wBAG9D,MAAOT,IAGXM,wBAAyB,SAASM,GAC9B,MAAO,IAAI5E,GAAK6B,eAAe+C,WASpCrI,KAAKgI,MAA6B,gBAAdhI,MAAKgI,OAC1BhI,KAAKgI,SAGTA,KAAKC,UAEHhC,QACEqC,KAAQ,mBACRC,KAAQ,mBACRC,KAAQ,mBACRC,KAAQ,kBACRC,kBACElC,KAAQ,SAIZmC,aACEC,iBACE7F,IAAO,iFAOXoF,sBACEU,KAAQ,SACRC,MAAS,GACT5B,YAAe,GACf6B,QACEC,OAAU,GAAG,IAAI,IAAI,KACrBC,KAAQ,EACRC,MAAS,EACTC,QAAW,EACXC,QAAW,EACXP,KAAQ,UACRQ,MAAS,gBACTC,SACEN,OAAU,IAAI,IAAI,IAAI,KACtB1C,MAAS,GACTuC,KAAQ,UACRQ,MAAS,kBASfjB,qBACES,KAAQ,SACRE,QACEC,OAAU,EAAE,IAAI,IAAI,KACpB1C,MAAS,EACTuC,KAAQ,UACRQ,MAAS,iBAQbnB,wBACEW,KAAQ,SACRE,QACEC,OAAU,GAAG,IAAI,IAAI,KACrBM,SACEN,OAAU,IAAI,IAAI,IAAI,KACtB1C,MAAS,GACTuC,KAAQ,UACRQ,MAAS,gBAEXR,KAAQ,UACRQ,MAAS,kBAKf,WAEE,YAEApJ,MAAKyD,OAAO,OAAQ,SAAU6F,EAAM3F,EAAK1D,EAAUC,GAEjDoJ,EAAKC,WAAarJ,EAAWsJ,SAASzF,QAEpC0F,SAAU,WACR1J,KAAK2J,iBAGPA,cAAe,WACb,GAEIvC,IACFwC,WAAW,EACXC,UAAW,EACXC,MAAM,GAKJxH,EAAasB,EAAIvB,eACrBC,GAAW2B,YAEX,IAAI8F,IACFC,KAAM,WACNC,WAAY,SAASC,GACnB,MAAOA,IAETC,WACEC,MAAO,IAETC,OAAQ/H,EAAWgI,YAGrBtK,MAAKuK,GAAGlJ,OAAOmJ,UAAUpD,EAAM2C,IAGjCU,oBAAqB,WAEnBzK,KAAK0K,MAAMC,KACT9I,EAAG7B,KAAKuK,GAAGlJ,OAAOmJ,UAAU,OAC5BI,KAAM,IAGR5K,KAAKqB,UAGPwJ,YAAa,WACX,GAAIhJ,GAAI7B,KAAKuK,GAAGlJ,OAAOmJ,UAAU,MACjCxK,MAAK0K,MAAMC,KACT9I,EAAGA,EACH+I,KAAM,KAIVE,UAAU,SAASC,GACD,KAAZA,EAAEC,QACJD,EAAEE,iBAEFjL,KAAKuK,GAAGlJ,OAAOmJ,UAAU,SAEzBxK,KAAK6K,cAEL7K,KAAKqB,WAIT6J,QAAS,WACPlL,KAAK6K,eAGPM,oBAAqB,WACnBnL,KAAK6K,cACL7K,KAAKqB,UAGPA,OAAQ,WACNuC,EAAIvC,iBAUZ,WAEE,YAEApB,MAAKyD,OAAO,SAAU,SAAUnD,EAAQqD,EAAK1D,EAAUC,EAAY0D,EAAG5B,GAKpE1B,EAAOC,YAAcN,EAASkL,MAAMpH,QAElCiE,UACEpG,EAAG,GACH+I,KAAM,EACNS,SAAU,GACVC,WAAY,GAGdC,mBAAqB,IAAK,OAAQ,WAAY,WAE9CC,eAAgB,WAEd,GAAI9I,GAAMT,EAAEwJ,KAAKzL,KAAK0L,SAAU1L,KAAKuL,kBAUrC,OAPA7I,GAAIkI,MACFe,OAAQjJ,EAAIkI,KACZ3B,KAAMvG,EAAI2I,gBAEL3I,GAAI2I,SAGJxH,EAAE+H,MAAMlJ,IAGjBpB,SAAU,WAIR,GAAIH,GAAQ,UAGZ,OADAA,IAAS,IAAMnB,KAAKwL,kBAItBK,OAAQ,WACN,MAAOjI,GAAIZ,OAAOC,IAAMjD,KAAKsB,mBASrCrB,KAAK+C,QAKHC,IAAK,yCAGPjD,KAAK8L,KAAOC,6BAA8B,SAASrJ,KACnDA,MAAQA,OACR,EAAA,GAAIsJ,KAAKC,IAAM,EAAUhK,GAAEiK,OAC3B,KAAMxJ,IACNuJ,KAAO,6FACsB,OAA3BD,IAAM,cAA4B,GAAKA,KACzC,YACqB,OAAnBA,IAAM,MAAoB,GAAKA,KACjC,uUACwB,OAAtBA,IAAM,SAAuB,GAAKA,KACpC,4EACwB,OAAtBA,IAAM,SAAuB,GAAKA,KACpC,oEACwB,OAAtBA,IAAM,SAAuB,GAAKA,KACpC,2GAC4B,OAA1BA,IAAM,aAA2B,GAAKA,KACxC,yEACoB,OAAlBA,IAAM,KAAmB,GAAKA,KAChC,2LAC4B,OAA1BA,IAAM,aAA2B,GAAKA,KACxC,sIACsB,OAApBA,IAAM,OAAqB,GAAKA,KAClC,oDAC6C,OAA3CA,IAAQG,OAAOC,WAAWC,YAAwB,GAAKL,KACzD,oDAC6C,OAA3CA,IAAQG,OAAOG,WAAWD,YAAwB,GAAKL,KACzD,iDACiC,OAA/BA,IAAQO,KAAKC,KAAK,QAAoB,GAAKR,KAC7C,kDACsB,OAApBA,IAAM,OAAqB,GAAKA,KAClC,8OAGA,OAAOC,MAEPQ,+BAAgC,SAAS/J,KACzCA,MAAQA,OACR,EAAA,GAAIsJ,KAAKC,IAAM,EAAUhK,GAAEiK,OAAcQ,MAAMC,UAAUH,KAEzD,KAAM9J,IAELT,EAAEC,KAAK0K,OAAQ,SAAUC,GAC1BZ,KAAO,YACgC,OAArCD,IAAQc,WAAWD,EAAM7C,OAAmB,GAAKgC,KACnD,YAEAC,KAAO,IAGP,OAAOA,MAEPc,2BAA4B,SAASrK,KACrCA,MAAQA,OACR,EAAA,GAAIsJ,KAAKC,IAAM,EAAUhK,GAAEiK,OAAcQ,MAAMC,UAAUH,KAEzD,KAAM9J,IACNuJ,KAAO,gBAC+B,OAApCD,IAAQgB,KAAKC,kBAA8B,GAAKjB,KAClD,QACoC,OAAlCA,IAAQkB,GAAGD,kBAA8B,GAAKjB,KAChD,QACuC,OAArCA,IAAQmB,MAAMF,kBAA8B,GAAKjB,KACnD,+IACC/J,EAAEC,KAAK0K,OAAQ,SAAUC,GAC1BZ,KAAO,eAEPA,KADKmB,YAAcP,EAAM7C,KAClB,uCACoB,OAAzBgC,IAAQa,EAAW,MAAa,GAAKb,KACvC,aAC0B,OAAxBA,IAAM,WAAyB,GAAKA,KACtC,sBAC0C,OAAxCA,IAAQa,EAAMQ,OAASR,EAAM7C,MAAkB,GAAKgC,KACtD,iDAC8B,OAA5BA,IAAM,eAA6B,GAAKA,KAC1C,yEAEO,uCACoB,OAAzBA,IAAQa,EAAW,MAAa,GAAKb,KACvC,sBAC0C,OAAxCA,IAAQa,EAAMQ,OAASR,EAAM7C,MAAkB,GAAKgC,KACtD,kCAEAC,KAAO,eAEPA,KAAO,+GACFqB,MAAMC,OAAS,IACpBtB,KAAO,sCACmB,OAAxBD,IAAM,WAAyB,GAAKA,KACtC,oBACyB,OAAvBA,IAAM,UAAwB,GAAKA,KACrC,qEACC/J,EAAEC,KAAKoL,MAAO,SAAU1C,GACzBqB,KAAO,yBACqB,OAA1BD,IAAQpB,EAAY,QAAa,GAAKoB,KACxC,wCAC0B,OAAxBA,IAAQpB,EAAU,MAAa,GAAKoB,KACtC,MAC0B,OAAxBA,IAAQpB,EAAU,MAAa,GAAKoB,KACtC,sBAEAC,KAAO,wCACkB,OAAvBD,IAAM,UAAwB,GAAKA,KACrC,oBACyB,OAAvBA,IAAM,UAAwB,GAAKA,KACrC,4DAEAC,KAAO,mBAGP,OAAOA,MAEPuB,sBAAuB,SAAS9K,KAChCA,MAAQA,OACR,EAAA,GAASuJ,KAAM,EAAUhK,GAAEiK,OAC3B,KAAMxJ,IACNuJ,KAAO,kHAGP,OAAOA,MAEPwB,sBAAuB,SAAS/K,KAChCA,MAAQA,OACR,EAAA,GAASuJ,KAAM,EAAUhK,GAAEiK,OAC3B,KAAMxJ,IACNuJ,KAAO,uFAGP,OAAOA,MAEPyB,sBAAuB,SAAShL,KAChCA,MAAQA,OACR,EAAA,GAASuJ,KAAM,EAAUhK,GAAEiK,OAC3B,KAAMxJ,IACNuJ,KAAO,stBAGP,OAAOA,MAEP0B,kCAAmC,SAASjL,KAC5CA,MAAQA,OACR,EAAA,GAASuJ,KAAM,EAAUhK,GAAEiK,OAC3B,KAAMxJ,IACNuJ,KAAO,8CAGP,OAAOA,MAEP2B,iCAAkC,SAASlL,KAC3CA,MAAQA,OACR,EAAA,GAAIsJ,KAAKC,IAAM,EAAUhK,GAAEiK,OAC3B,KAAMxJ,IACNuJ,KAAO,QACc,OAAnBD,IAAM,MAAoB,GAAKA,KACjC,eACsB,OAApBA,IAAM,OAAqB,GAAKA,KAClC,eAC4B,OAA1BA,IAAM,aAA2B,GAAKA,KACxC,eACyB,OAAvBA,IAAM,UAAwB,GAAKA,KACrC,eACsB,OAApBA,IAAM,OAAqB,GAAKA,KAClC,eAC4C,OAA1CA,IAAQG,OAAOC,WAAWyB,WAAuB,GAAK7B,KACxD,eAC4C,OAA1CA,IAAQG,OAAOG,WAAWuB,WAAuB,GAAK7B,KACxD,SAGA,OAAOC,MAEP6B,oCAAqC,SAASpL,KAC9CA,MAAQA,OACR,EAAA,GAASuJ,KAAM,EAAUhK,GAAEiK,OAC3B,KAAMxJ,IACNuJ,KAAO,ySAGP,OAAOA,MAEP8B,4BAA6B,SAASrL,KACtCA,MAAQA,OACR,EAAA,GAAIsJ,KAAKC,IAAM,EAAUhK,GAAEiK,OAAcQ,MAAMC,UAAUH,KAEzD,KAAM9J,IACNuJ,KAAO,WACD+B,sBACN/B,KAAO,+BACW,OAAhBD,IAAM,GAAiB,GAAKA,KAC9B,mBAC4C,OAA1CA,IAAQV,WAAW2B,kBAA8B,GAAKjB,KACxD,iBAEAC,KAAO,qaACFqB,MAAMC,OAAS,IACpBtB,KAAO,sCACmB,OAAxBD,IAAM,WAAyB,GAAKA,KACtC,gBACwB,OAAtBA,IAAM,SAAuB,GAAKA,KACpC,iBACyB,OAAvBA,IAAM,UAAwB,GAAKA,KACrC,+DACC/J,EAAEC,KAAKoL,MAAO,SAAU1C,GACzBqB,KAAO,yBACqB,OAA1BD,IAAQpB,EAAY,QAAa,GAAKoB,KACxC,gBACyB,OAAvBA,IAAQpB,EAAS,KAAa,GAAKoB,KACrC,qCAC0B,OAAxBA,IAAQpB,EAAU,MAAa,GAAKoB,KACtC,MAC0B,OAAxBA,IAAQpB,EAAU,MAAa,GAAKoB,KACtC,sBAEAC,KAAO,wCACkB,OAAvBD,IAAM,UAAwB,GAAKA,KACrC,gBACwB,OAAtBA,IAAM,SAAuB,GAAKA,KACpC,iBACyB,OAAvBA,IAAM,UAAwB,GAAKA,KACrC,4DAEAC,KAAO,qBAGP,OAAOA,OAGP,WAEE,YAEAhM,MAAKyD,OAAO,OAAQ,SAAUhD,GAE5BA,EAAKuN,iBAAmBhO,KAAKsJ,KAAKC,WAAWxF,QAE3CC,WAAY,WACVjE,KAAKkO,SAASlO,KAAK0K,MAAO,WAAY1K,KAAKmO,iBAG7CC,GAAI,2BAEJC,UAAU,EAEVC,QACEC,yBAA0B,YAC1BC,uBAAwB,UACxBC,2BAA4B,sBAC5BC,2BAA4B,uBAG9BnE,IACElJ,OAAQ,kBAGV8M,eAAgB,WACdnO,KAAKuK,GAAGlJ,OAAOmJ,UAAU,MAAOxK,KAAK0K,MAAM1D,IAAI,cAUvD,WAEE,YAEA/G,MAAKyD,OAAO,OAAQ,SAAUhD,EAAMkD,EAAK1D,EAAUC,EAAY0D,EAAG5B,GAEhEvB,EAAKC,OAASR,EAAWwO,WAAW3K,QAElCC,WAAY,WACVhC,EAAE2M,QAAQ5O,KAAM,cAChBA,KAAK6O,iBAAmB,GAAInO,GAAKuN,kBAAmBvD,MAAO9G,EAAItD,cAAewO,UAGhFV,GAAI,OAEJW,SACEC,KAAM,gBAGRV,QACEW,mBAAoB,gBAGtBC,aAAc,SAAUnE,GACjBA,EAAEoE,SAAYpE,EAAEqE,UACnBrE,EAAEE,iBACFrH,EAAI3C,SAAS,IAAMC,SAAS,MAIhCL,WAAY,WACV,GAAIwO,GAAOrP,IACgD,KAAvDE,EAASU,QAAQkB,cAAcwN,QAAQ,YACzCD,EAAKE,IAAIC,YAAY,aAErBH,EAAKE,IAAIE,SAAS,qBAW5B,WAEE,YAEAxP,MAAKyD,OAAO,aAAc,SAAUgM,EAAY9L,GAE9C8L,EAAWC,KAAO1P,KAAKsJ,KAAKC,WAAWxF,QAErCC,WAAY,WACVjE,KAAK0K,MAAQ9G,EAAItD,aAGnB+N,SAAUvC,IAAI,uBAEdwC,QACEsB,kBAAmB,YACnBC,gBAAiB,UACjBC,oBAAqB,sBACrBpB,2BAA4B,uBAG9BnE,IACElJ,OAAQ,WAGV0O,GAAI,OAEJC,aAAc,WACZhQ,KAAKuK,GAAGlJ,OAAO4O,gBAUvB,WAEE,YAEAhQ,MAAKyD,OAAO,aAAc,SAAUgM,EAAY9L,EAAK1D,EAAUC,GAE7DuP,EAAWQ,WAAa/P,EAAW+P,WAAWlM,QAE5CmM,OAAQ,WACN,GAAIC,GAAO,GAAIV,GAAWC,IAC1B/L,GAAInD,OAAO4P,UAAU,QAAQC,KAAKF,WAU1C,WAEE,YAEAnQ,MAAKyD,OAAO,aAAc,SAAUgM,EAAY9L,EAAK1D,GAGnDwP,EAAWa,OAASrQ,EAASC,WAAWqQ,UAAUxM,QAChDyM,WACE,GAAI,UAKRf,EAAWgB,eAAe,WACX,GAAIhB,GAAWa,QAASI,WAAYjB,EAAWkB,QAI9DlB,EAAWkB,KAETN,KAAM,SAASlP,GAETpB,KAAK6Q,iBACP7Q,KAAK6Q,eAAiB,GAAInB,GAAWQ,WAAW9O,IAGlDpB,KAAK6Q,eAAeV,OAAO/O,UAOnC,WAEE,YAEAnB,MAAKyD,OAAO,SAAU,SAAUnD,EAAQqD,EAAK1D,EAAUC,EAAY0D,EAAG5B,GAKpE1B,EAAOuQ,aAAe5Q,EAASkL,MAAMpH,QAEnCiE,UACE8H,GAAI,GACJ/F,KAAM,GACN9C,YAAa,GACbqF,QACAwE,YAAa,GACbC,YAAa,GACbC,SAAU,GACVC,MAAO,GACPnO,IAAK,GACLqJ,UAAW,GACXE,UAAW,GACX6E,MAAO,EACPC,aAAc,IAGhBC,MAAO,SAAUhO,GAEf,GAAIiO,GAAOjO,EAASC,MAAQD,CAC5B,OAAOpB,GAAE+B,QAAQ+L,GAAIuB,EAAKvB,IAAKuB,EAAKxE,aAGtC/J,IAAK,WACH,MAAO9C,MAAK+C,OAAOC,IAAM,YAAcjD,KAAKgH,IAAI,OAGlDuK,iBAAkB,WAChB,GAAI3E,GAAS5M,KAAKgH,IAAI,SACtB,OAAO/E,GAAEmB,OAAOwJ,EAAQ,SAAU1C,GAChC,MAAOjI,GAAEuP,UAAW,sBAAuB,sBAAuB,wBAA0BtH,EAAKrB,gBAW3G,WAEE,YAEA5I,MAAKyD,OAAO,SAAU,SAAUnD,EAAQqD,EAAK1D,EAAUC,EAAY0D,EAAG5B,GAKpE1B,EAAOkR,kBAAoBvR,EAASwR,WAAW1N,QAE7C0G,MAAOnK,EAAOuQ,aAEd/N,IAAK,WACH,MAAOa,GAAItD,YAAYuL,UAGzBwF,MAAO,SAAUC,GAEf,GAAI5O,IACFkI,KAAM0G,EAAKK,KAAKC,gBAAgBhH,KAAKe,OACrCN,SAAUiG,EAAKK,KAAKC,gBAAgBhH,KAAK3B,KAI3C,OAFArF,GAAItD,YAAYqK,IAAI1I,EAAE+B,OAAOtB,EAAK4O,EAAKK,KAAKE,QAErCP,EAAKhO,aAUpB,WAEE,YAEArD,MAAKyD,OAAO,gBAAiB,SAAUoO,EAAelO,EAAK1D,EAAUC,EAAY0D,GAE/EiO,EAAcrI,SAAWtJ,EAAWsJ,SAASzF,QAE3CqK,SAAUvC,IAAI,kCAEdpB,MAAOzK,KAAKM,OAAOuQ,aAEnBiB,QAAS,KAETzD,QACE0D,MAAO,WAGTC,QAAS,WACPjS,KAAKkB,QAAQ,iBAAkBlB,KAAK0K,UAKxCoH,EAAcI,YAAc/R,EAAWsJ,SAASzF,QAE9CqK,SAAUvC,IAAI,qCAEdiG,QAAS,KAETI,UAAW,YAIbL,EAAcM,UAAYjS,EAAWsJ,SAASzF,QAE5CqK,SAAUvC,IAAI,mCAEdiG,QAAS,OAIXD,EAAcnC,KAAOxP,EAAWkS,cAAcrO,QAE5CC,WAAY,WACVjE,KAAKkO,SAASlO,KAAM,2BAA4BA,KAAKsS,gBAGvDtE,qBAAqB,EAErBK,SAAUvC,IAAI,6BAEdyG,UAAWT,EAAcrI,SAEzB+I,mBAAoB,QAEpBC,aAAc,WACZ,MAAIzS,MAAKgO,oBACA8D,EAAcI,YAEdJ,EAAcM,WAIzB9D,QACEoE,wBAAyB,iBAG3BC,aACEC,oBAAqB,UAGvBC,kBACEC,KAAQ,mBACRC,MAAS,oBAGXhD,GAAI,eAEJiD,iBAAkB,WAChBhT,KAAKgO,qBAAsB,EAC3BhO,KAAK8O,UAGPwD,cAAe,SAAUC,EAAWU,GAClCrP,EAAIrC,gBAAgB0R,EAAWjM,IAAI,QAGrCkM,cAAe,SAAUnI,GAEvB,IAAKA,EAAEoE,UAAWpE,EAAEqE,QAAS,CAC3BrE,EAAEoI,kBACFpI,EAAEE,gBACF,IAAIL,GAAO/G,EAAEkH,EAAEqI,QAAQC,QAAQ,KAAK/P,KAAK,OAIzCtD,MAAK0K,MAAMC,IAAI,OAAQC,GACvBhH,EAAIvC,WAIRiS,gBAAiB,WAkBf,IAAK,GADDC,GAfAC,EAAO5P,EAAItD,YAAYoL,SAEvB+H,EAAMC,KAAKC,MAAMH,EAAKlI,YACtBV,GAAQ4I,EAAK5I,KACboC,EAAiB,IAATpC,EAAcA,EAAO,EAAIA,EACjC3B,EAAOuK,EAAKnI,SACZuI,EAAcF,KAAKG,KAAKJ,EAAMxK,GAC9BqE,KAGAxM,EAAU8S,EAAc,IAAM5G,EAAO,EAAMA,EAAO,EAAI,EACtD8G,EAAQF,EAAc9S,EAAQ,EAAMA,EAAQ,EAAI8S,EAGhDtT,EAAcN,KAAK0K,MAAMqJ,QAEpBC,EAAIlT,EAAYgT,GAALE,EAAUA,IAC5BT,EAAUS,IAAMhH,EAAQ,SAAW,GACnC1M,EAAYqK,IAAI,OAAQqJ,GACxB1G,EAAM2G,MAAOlR,IAAKzC,EAAYgB,UAAS,GAAQsJ,KAAMoJ,EAAGT,OAAQA,GAGlE,IAAIW,GAAUlU,KAAK0K,MAAMpJ,UAAS,GAC9B6S,EAAWvJ,CACF,KAAToC,IACFmH,EAAWvJ,EAAK,EAChBtK,EAAYqK,IAAI,OAAQwJ,GACxBD,EAAU5T,EAAYuL,SAExB,IAAIuI,GAAUpU,KAAK0K,MAAMpJ,UAAS,GAC9B+S,EAAWzJ,CAOf,OANIgJ,KAAgB5G,IAClBqH,EAAWzJ,EAAO,EAClBtK,EAAYqK,IAAI,OAAQ0J,GACxBD,EAAU9T,EAAYuL,WAItByI,UAAqB,IAATtH,EAAc,WAAa,GACvCuH,SAAWX,IAAgB5G,EAAQ,WAAa,GAChDkH,QAASA,EACTE,QAASA,EACTD,SAAUA,EACVE,SAAUA,EACV/G,MAAOA,EACPU,oBAAqBhO,KAAKgO,6BAWpC,WAEE,YAEA/N,MAAKyD,OAAO,gBAAiB,SAAUoO,EAAelO,EAAK1D,EAAUC,GAEnE2R,EAAc5B,WAAa/P,EAAW+P,WAAWlM,QAE/CmM,OAAQ,WACNnQ,KAAKwU,WAAa,GAAI5Q,GAAIrD,OAAOkR,kBACjCzR,KAAKwU,WAAWC,OAAQC,OAAO,IAC/B1U,KAAKoQ,KAAO,GAAI0B,GAAcnC,MAAOjF,MAAO9G,EAAItD,YAAakU,WAAYxU,KAAKwU,aAC9E5Q,EAAInD,OAAO4P,UAAU,QAAQC,KAAKtQ,KAAKoQ,cAU/C,WAEE,YAEAnQ,MAAKyD,OAAO,gBAAiB,SAAUoO,EAAelO,EAAK1D,GAGzD4R,EAAcvB,OAASrQ,EAASC,WAAWqQ,UAAUxM,QACnDyM,WACEkE,cAAe,UAKnB7C,EAAcpB,eAAe,WACd,GAAIoB,GAAcvB,QAASI,WAAYmB,EAAclB,QAIpEkB,EAAclB,KAEZN,KAAM,SAASlP,GAEb,GAAIwT,GAAWhR,EAAIjC,qBAInBiC,GAAItD,YAAYqK,IAAIiK,GAEhB5U,KAAK6U,oBACP7U,KAAK6U,kBAAoB,GAAI/C,GAAc5B,WAAW9O,IAGxDpB,KAAK6U,kBAAkB1E,OAAO/O,UAQtC,WAEE,YAEAnB,MAAKyD,OAAO,SAAU,SAAUnD,EAAQqD,EAAK1D,GAK3CK,EAAOuU,WAAa5U,EAASkL,MAAMpH,gBASvC,WAEE,YAEA/D,MAAKyD,OAAO,SAAU,SAAUnD,EAAQqD,EAAK1D,EAAUC,EAAY0D,EAAG5B,GAKpE1B,EAAOwU,cAAgB7U,EAASwR,WAAW1N,QAEzCC,WAAY,SAAU6I,EAAY1L,GAChCpB,KAAK8G,QAAU1F,EAAQ0F,OAEvB,IAAIkO,GAAoBhV,KAAK8G,QAAQE,IAAI,4BACzChH,MAAKiV,mBAAqBD,GAAqBA,EAAkBC,mBAEjEjV,KAAKkV,QAAUlV,KAAK8G,QAAQE,IAAI,kBAGlCmO,QAAS,GAETvK,KAAM,EAENsK,QAAS,GAETE,YAAY,EAEZ1K,MAAOnK,EAAOuU,WAEdO,YAAa,WACX,GAAItS,GAAM/C,KAAK8G,QAAQE,IAAI,MAC3BjE,IAAO,gYAEH/C,KAAKiV,qBACPlS,GAAO,iBAAmB/C,KAAK4K,KAAO5K,KAAKmV,QAC3CpS,GAAO,sBAAwB/C,KAAKmV,QAOtC,IAAID,GAAUlV,KAAKkV,OASnB,OARKlV,MAAKoV,aACRF,GAAW,SAKbnS,GAAO,kBAAoBmS,GAK7BnS,IAAK,WACH,MAAO/C,MAAKqV,eAGdhE,MAAO,SAAUC,GAGf,GAAIgE,GAAOhE,EAAKiE,QAQhB,OAPKvV,MAAKiV,qBAKRK,EAAOrT,EAAEuT,MAAMF,EAAMtV,KAAKmV,UAErBG,UAUf,WAEE,YAEArV,MAAKyD,OAAO,iBAAkB,SAAU+R,EAAgB7R,EAAK1D,EAAUC,EAAY0D,GAEjF4R,EAAeC,aAAevV,EAAWsJ,SAASzF,QAEhDC,WAAY,SAAU7C,GACpBpB,KAAK8G,QAAU1F,EAAQ0F,QACvB9G,KAAK4M,OAAS5M,KAAK8G,QAAQE,IAAI,WAGjCqH,SAAUvC,IAAI,gCAEdwH,gBAAiB,WACf,GAAIjE,GAAOrP,IACX,QACE4M,OAAQyC,EAAKzC,SAIjBlC,MAAOzK,KAAKM,OAAOuU,WAEnB/C,QAAS,OAIX0D,EAAeE,UAAYxV,EAAWkS,cAAcrO,QAElDC,WAAY,WACVjE,KAAKwU,WAAa,GAAI5Q,GAAIrD,OAAOwU,kBAAoBjO,QAAS9G,KAAK0K,QACnE1K,KAAKwU,WAAWC,SAGlBnG,QACEsH,2BAA4B,gBAC5BC,iBAAkB,QAGpBhD,kBAEEiD,MAAS,UAGXzH,SAAUvC,IAAI,4BAEdyG,UAAWkD,EAAeC,aAE1BK,iBAAkB,WAChB,GAAIjP,GAAU9G,KAAK0K,KACnB,QACE5D,QAASA,IAIbwM,gBAAiB,WAGf,GAAI5Q,IACF4R,UAAW,GACXC,SAAU,GACVJ,SAAU,EACVE,SAAU,EACV/G,SACA0I,gBAAgB,EAChBhJ,KAAM,EACNE,GAAIlN,KAAKwU,WAAWW,QACpBhI,MAAOnN,KAAK0K,MAAM1D,IAAI,eACtBoG,UAAWpN,KAAKwU,WAAWU,QAC3Be,UAAWjW,KAAKwU,WAAWY,WAAa,WAAa,YACrDc,cAAelW,KAAKwU,WAAWY,WAAa,yBAA2B,uBAGzE,IAAIpV,KAAKwU,WAAWS,mBAAoB,CAUtC,IAAK,GADD1B,GARA4C,EAAazC,KAAKG,KAAK7T,KAAK0K,MAAM1D,IAAI,eAAiBhH,KAAKwU,WAAWW,SAEvEvK,EAAO5K,KAAKwU,WAAW5J,KAGvB9J,EAASqV,EAAa,IAAMvL,EAAO,EAAKA,EAAO,EAAI,EACnDkJ,EAAOqC,EAAarV,EAAQ,EAAKA,EAAQ,EAAIqV,EAErC7I,KACH0G,EAAIlT,EAAYgT,GAALE,EAAUA,IAC5BT,EAAUS,IAAMpJ,EAAO,EAAK,SAAW,GACvC0C,EAAM2G,MAAOrJ,KAAMoJ,EAAGT,OAAQA,GAGhC,IAAIpG,GAAQnN,KAAK0K,MAAM1D,IAAI,eACvBgG,EAAOpC,EAAO5K,KAAKwU,WAAWW,QAAU,EACxCjI,EAAKtC,EAAO5K,KAAKwU,WAAWW,QAAUnV,KAAKwU,WAAWW,OAC1DjI,GAAYC,GAAND,EAAeA,EAAKC,EAE1BzK,GACE4R,UAAqB,IAAT1J,EAAc,WAAa,GACvC2J,SAAW4B,IAAevL,EAAO,EAAK,WAAa,GACnDuJ,SAAUvJ,EACVyJ,SAAUzJ,EAAO,EACjB0C,MAAOA,EACP0I,gBAAgB,EAChBhJ,KAAMA,EACNE,GAAIA,EACJC,MAAOA,EACPC,UAAWpN,KAAKwU,WAAWU,QAC3Be,UAAWjW,KAAKwU,WAAWY,WAAa,WAAa,YACrDc,cAAelW,KAAKwU,WAAWY,WAAa,yBAA2B,wBAI3E,MAAO1S,IAGT8P,mBAAoB,QAEpBU,cAAe,SAAUnI,GACvB,GAAIqL,GAASvS,EAAEkH,EAAEqI,QAAQC,QAAQ,KAC7BgD,EAAKD,EAAO/C,QAAQ,KACxB,KAAKgD,EAAGC,SAAS,cAAgBD,EAAGC,SAAS,UAAW,CACtD,GAAI1L,GAAOwL,EAAO9S,KAAK,QAAU,CACjCtD,MAAKwU,WAAW5J,KAAOA,EACvB5K,KAAKwU,WAAWC,OAAQqB,OAAO,MAInCS,KAAM,SAAUxL,GACd,GAAImK,GAAUrR,EAAEkH,EAAEqI,QAAQ9P,KAAK,YAC3B4R,KAEAlV,KAAKwU,WAAWY,WADdF,IAAYlV,KAAKwU,WAAWU,SACAlV,KAAKwU,WAAWY,YAEjB,EAE/BpV,KAAKwU,WAAW5J,KAAO,EACvB5K,KAAKwU,WAAWU,QAAUA,EAC1BlV,KAAKwU,WAAWC,OAAQqB,OAAO,aAWzC,WAEE,YAEA7V,MAAKyD,OAAO,iBAAkB,SAAU+R,EAAgB7R,EAAK1D,EAAUC,EAAY0D,EAAG5B,GAEpFwT,EAAe9F,KAAOxP,EAAWsJ,SAASzF,QAExCC,WAAY,SAAU7C,GACpBa,EAAE2M,QAAQ5O,KAAM,kBAAmB,cACnCA,KAAKwW,WAAapV,EAAQoV,YAG5BnI,SAAUvC,IAAI,8BAEdiE,GAAI,eAEJxF,IACEzE,OAAU,OACV2Q,eAAkB,oBAGpB9D,aACE+D,OAAU,UAGZpD,gBAAiB,WACf,GAAIqD,GAAU3W,KAAK0K,MAAM3H,MAAMrB,QAAQ,SAAU,IAAIA,QAAQ,UAAW,IACpE0P,EAAepR,KAAK0K,MAAM1D,IAAI,gBAC9B4P,EAAsB,kCAC1B,QACED,QAASA,EACTE,aAAczF,GAAgBwF,IAIlClN,SAAU,WAER1J,KAAK8W,UAAY,GAAIrB,GAAeE,WAAYvH,GAAIpO,KAAKuK,GAAGkM,eAAgB/L,MAAO1K,KAAK0K,QAASoE,UAOnGkB,aAAc,WACZ,GAAiD,UAA7ChQ,KAAK0K,MAAM1D,IAAI,YAAY+P,cAA2B,CACxD,GAAI1H,GAAOrP,IAEXA,MAAKuK,GAAGzE,OAAOwK,OACftQ,KAAKwW,WAAW/R,UAAUuS,KAAK,WAC7B3H,EAAKmH,WAAW3Q,UAAU,OAASU,OAAQ8I,EAAK3E,MAAM1D,IAAI,UAAUiQ,cACpE5H,EAAKmH,WAAW7O,WAAW0H,EAAK3E,WAOtCwM,UAAW,WACT,GAAIC,GAAWnX,KAAK0K,MAAM6G,kBAE1B,IAAI4F,EAAS5J,OAAO,CAIlBvN,KAAKoX,UAAYpX,KAAKoX,WAAaD,EAAS,GAAGnN,IAG/C,IAAI4C,GAAS5M,KAAK0K,MAAM1D,IAAI,SAC5BhH,MAAK6R,MAAQ7R,KAAKqX,SAASzK,EAAQ5M,KAAKoX,WACxCpX,KAAK6I,KAAO7I,KAAKsX,gBAAgBtX,KAAK0K,MAAM1D,IAAI,gBAGhD,IAAIuQ,IACF3K,OAAQuK,EACRtK,MAAO7M,KAAKoX,UACZI,WAAYxX,KAAK6R,MACjBhJ,KAAM7I,KAAK6I,KACX4O,QAASzX,KAAK0X,aAGX1X,MAAK2X,MAGR9T,EAAE,mBAAmB+T,SACrB5X,KAAK2X,KAAO,GAAIE,MAAK,QAASN,IAH9BvX,KAAK2X,KAAO,GAAIE,MAAK,QAASN,GAOhCvX,KAAK2X,KAAKtX,GAAG,SAAUL,KAAK8X,iBAC5B9X,KAAK2X,KAAKtX,GAAG,cAAeL,KAAK+X,YAEjC/X,KAAKgY,kBAKTX,SAAU,SAAUzK,EAAQwK,GAC1B,GAAIa,GAAWhW,EAAEiW,UAAUtL,GAAU5C,KAAMoN,GAC3C,OAAOa,GAAWA,EAAST,WAAa,MAG1CF,gBAAiB,SAAUa,GACzB,OAAQA,GACN,IAAK,oBACL,IAAK,yBACH,MAAO,OACT,KAAK,uBACH,MAAO,MACT,KAAK,sBACH,MAAO,SACT,SACE,MAAOA,GAASpB,gBAItBW,WAAY,WACV,GAAIU,GAAOC,EAAWhJ,EAAOrP,IAC7B,QAAQA,KAAK6I,MACX,IAAK,QACHuP,EAAQ,UACRC,EAAY,MACZ,MACF,KAAK,UACHD,EAAQ,cACRC,EAAY,aAKhB,MAAO5U,MAAK6U,OAAOD,GAAWX,YAC5BU,MAAOA,EACPpS,QAAS,YACT8B,aAAcuH,EAAKxG,QAKvBiP,gBAAiB,SAAUV,GAEzB,GAAIxK,GAAS5M,KAAK0K,MAAM1D,IAAI,SAC5BhH,MAAK6R,MAAQ7R,KAAKqX,SAASzK,EAAQwK,GACnCpX,KAAKoX,UAAYA,EAEjBpX,KAAKgY,cAAchY,KAAKuY,iBAI1BR,WAAY,SAAUS,GACpBxY,KAAKuY,eAAiBvY,KAAK0X,aAAae,iBAAiBD,GACzDxY,KAAKgY,cAAchY,KAAKuY,iBAI1BP,cAAe,SAAUU,GACvB,GAAIrJ,GAAOrP,KAEPoH,GACFyF,MAAO7M,KAAKoX,UACZpR,QAAS,YACTwR,WAAYxX,KAAK6R,MACjBhJ,KAAM7I,KAAK6I,KAGT6P,KACFtR,EAAKsR,OAASA,EAGN9U,GAAI+U,OAAOC,QAAQ,qBAAsBxR,GAChD4P,KAAK,SAASvP,GACK,UAAd4H,EAAKxG,MACPwG,EAAKsI,KAAKkB,iBAAiBpR,EAASqR,WAK5CC,UAAW,WACT/Y,KAAKwW,WAAWhR,UAChBxF,KAAK8W,UAAUtR,kBAUvB,WAEE,YAEAvF,MAAKyD,OAAO,iBAAkB,SAAU+R,EAAgB7R,EAAK1D,EAAUC,EAAY0D,EAAG5B,GAEpFwT,EAAevF,WAAa/P,EAAW+P,WAAWlM,QAEhDC,WAAY,WACVhC,EAAE2M,QAAQ5O,KAAM,mBAGlBmQ,OAAQ,SAAU/O,GAChBpB,KAAKwW,WAAa,GAAI5S,GAAID,MAAMG,WAChC9D,KAAK0K,MAAQ,GAAI9G,GAAIrD,OAAOuQ,cAAef,GAAI3O,IAC/CpB,KAAK0K,MACF+J,QACEuC,KAAKhX,KAAKgZ,gBACVC,KAAK,WACJrV,EAAInC,iBAIZuX,eAAgB,WACd,GAAI5I,GAAO,GAAIqF,GAAe9F,MAAOjF,MAAO1K,KAAK0K,MAAO8L,WAAYxW,KAAKwW,YACzE5S,GAAInD,OAAO4P,UAAU,QAAQC,KAAKF,IAGpC7M,gBAAiB,WACXvD,KAAKwW,YACPxW,KAAKwW,WAAWhR,kBAW1B,WAEE,YAEAvF,MAAKyD,OAAO,iBAAkB,SAAU+R,EAAgB7R,EAAK1D,GAG3DuV,EAAelF,OAASrQ,EAASC,WAAWqQ,UAAUxM,QACpDyM,WACEyI,kBAAmB,UAKvBzD,EAAe/E,eAAe,WACf,GAAI+E,GAAelF,QAASI,WAAY8E,EAAe7E,QAItE6E,EAAe7E,KAEbN,KAAM,SAASlP,GAETpB,KAAKmZ,qBACPnZ,KAAKmZ,mBAAqB,GAAI1D,GAAevF,WAAW9O,IAG1DpB,KAAKmZ,mBAAmBhJ,OAAO/O,UAOvC,WAEE,YAEAnB,MAAKyD,OAAO,cAAe,SAAU0V,EAAaxV,EAAK1D,EAAUC,GAE/DiZ,EAAYzJ,KAAOxP,EAAWsJ,SAASzF,QAErC+L,GAAI,aAEJsJ,YAAa,WACX,GACIhL,GADAiL,EAAYtZ,KAAK0K,MAAM1D,IAAI,YAG/B,QAAQsS,GACN,IAAK,KACHjL,EAAWvC,IAAI,sBACf,MACF,SACEuC,EAAWvC,IAAI,uBAGnB,MAAOuC,WAUf,WAEE,YAEApO,MAAKyD,OAAO,cAAe,SAAU0V,EAAaxV,EAAK1D,EAAUC,GAE/DiZ,EAAYlJ,WAAa/P,EAAW+P,WAAWlM,QAE7CmM,OAAQ,SAAU/O,GAEhB,GAAIsJ,GAAQ,GAAIxK,GAASkL,OAAQkO,UAAWlY,EAAQkY,YAChDlJ,EAAO,GAAIgJ,GAAYzJ,MAAOjF,MAAOA,GAEzC9G,GAAInD,OAAO4P,UAAU,QAAQC,KAAKF,WAU1C,WAEE,YAEAnQ,MAAKyD,OAAO,cAAe,SAAU0V,EAAaxV,EAAK1D,GAGrDkZ,EAAY7I,OAASrQ,EAASC,WAAWqQ,UAAUxM,QACjDyM,WACE8I,IAAO,WACPC,IAAO,cAKXJ,EAAY1I,eAAe,WACZ,GAAI0I,GAAY7I,QAASI,WAAYyI,EAAYxI,QAIhEwI,EAAYxI,KAEV6I,eAAgB,WACVzZ,KAAK0Z,kBACP1Z,KAAK0Z,gBAAkB,GAAIN,GAAYlJ,aAI3CyJ,SAAU,WACR3Z,KAAKyZ,iBACLzZ,KAAK0Z,gBAAgBvJ,QAASmJ,UAAW,OAG3CM,SAAU,WACR5Z,KAAKyZ,iBACLzZ,KAAK0Z,gBAAgBvJ,QAASmJ,UAAW,aAOjDzV,EAAE,WACA,YAEA5D,MAAKa","file":"scripts/main.js","sourcesContent":["/*jshint -W020 */\n\nif (!this.MyOD || typeof this.MyOD !== 'object') {\n  this.MyOD = {};\n}\n\n(function () {\n  'use strict';\n\n  MyOD = new Backbone.Marionette.Application();\n\n  MyOD.on('before:start', function(options){\n    this.searchModel = new MyOD.Models.SearchModel();\n    this.layout = new MyOD.Main.Layout();\n    //this.reqres = new Backbone.Wreqr.RequestResponse();\n  });\n\n  MyOD.on('start', function(options){\n    Backbone.history.on('route', this.layout.setClasses);\n\n    if (Backbone.history){\n      //if you are hosting on a server that can let the browser handle all the routing,\n      //you can use pushstate, otherwise (gh-pages) use hashed urls\n      //Backbone.history.start({ pushState: Modernizr.history, root: '/OpenData-Backbone' });\n      //Backbone.history.start returns false if the current url doesn't match a route\n      if (!Backbone.history.start({ pushState: false, root: '/OpenData-Backbone' })) {\n        MyOD.navigate('404', { trigger:true });\n      }\n    }\n  });\n\n  MyOD.navigate = function (route, options) {\n    Backbone.history.navigate(route, options);\n  };\n\n  MyOD.search = function (options) {\n    var route = MyOD.searchModel.getRoute();\n    MyOD.navigate(route, { trigger: true });\n  };\n\n  MyOD.navigateDataset = function (datasetId) {\n    MyOD.navigate('/datasets/' + datasetId, { trigger: true });\n  };\n\n  MyOD.navigate404 = function () {\n    MyOD.navigate('404', { trigger: true, replace: true });\n  };\n\n  MyOD.queryStringToObject = function () {\n    var result = {};\n\n    var q = Backbone.history.getFragment().split('?')[1];\n\n    if (q) {\n      var pairs = q.split('&');\n\n      _.each(pairs, function(pair) {\n        pair = pair.split('=');\n        if (pair[0] === 'q') {\n          result[pair[0]] = pair[1].replace(/\\+/g, ' ') || '';\n        } else {\n          result[pair[0]] = decodeURIComponent(pair[1] || '');\n        }\n      });\n    }\n\n    return result;\n  };\n\n  //by putting it on app instead of this base view, we can share one instance throughout the app\n  //instead of having one instance per view that needs one\n  MyOD.getBloodhound = function () {\n    if (!this.bloodhound) {\n      this.bloodhound = new Bloodhound({\n        datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),\n        queryTokenizer: Bloodhound.tokenizers.whitespace,\n        limit: 10,\n        remote: {\n          url: MyOD.config.api.replace('/api/v2', '') + 'datasets/autocomplete.json?query=%QUERY',\n          rateLimitWait: 150,\n          replace: function (url, query) {\n            return url.replace('%QUERY', query);\n          },\n          filter: function(response) {\n            return response ? response.data : [];\n          }\n        }\n      });\n    }\n    return this.bloodhound;\n  };\n\n  MyOD.onBeforeDestroy = function () {\n    Backbone.history.stop();\n  };\n\n})();\n\n(function () {\n    \n  'use strict';\n\n  // namespace the esri stuff - there's prolly a better way to do this...\n  var esri = {};\n\n  MyOD.module('Utils', function (Utils, App, Backbone, Marionette, $, _) {\n\n    Utils.MapManager = Marionette.Object.extend({\n      \n      initialize: function () {\n        this.globalChannel = Backbone.Wreqr.radio.channel('global');\n        //load dojo and start the map\n        this._loadDojo();\n      },\n\n      /**\n       * load dojo, resolve a promise when it's ready to roll\n       */\n      _loadDojo: function() {\n        var dfd = $.Deferred();\n        this.dojoReady = dfd.promise();\n        //check if dojo is loaded...\n        if( !window.dojo ){\n          //if not, inject a script tag, and then require in things\n          include('//js.arcgis.com/4.0beta1/', function(){\n            //now that require is present, load in the other things we need\n            require([\n              'esri/Map',\n              'esri/views/MapView',\n              'esri/layers/FeatureLayer',\n              'esri/widgets/PopupTemplate',\n              'esri/geometry/SpatialReference',\n              'esri/geometry/Extent',\n              'esri/renderers/SimpleRenderer',\n              'dojo/domReady!'\n            ], function(Map, MapView, FeatureLayer, PopupTemplate, SpatialReference, Extent, SimpleRenderer) {\n              esri.Map = Map;\n              esri.MapView = MapView;\n              esri.FeatureLayer = FeatureLayer;\n              esri.PopupTemplate = PopupTemplate;\n              esri.SpatialReference = SpatialReference;\n              esri.Extent = Extent;\n              esri.SimpleRenderer = SimpleRenderer;\n              //, MapView, FeatureLayer, PopupTemplate, SpatialReference, Extent, SimpleRenderer\n              dfd.resolve();\n            });\n          }); \n\n        }else{\n          //it's loaded\n          dfd.resolve();\n        }\n      },\n\n      onBeforeDestroy: function () {\n        if (this.map) {\n          this.map.destroy();\n        }\n      },\n\n      proxyEvent: function (evtName, evt) {\n        this.globalChannel.vent.trigger(evtName, evt);\n        //OR (if everything that will listen has a reference to this)\n        //this.trigger(evtName, evt);\n      },\n\n      createMap: function (mapDiv, options) {\n        var mapOpts = {\n          basemap: 'dark-gray'\n        };\n\n        this.map = new esri.Map(mapOpts);\n\n        var $mapDiv = $('#map');\n\n        var mapViewOpts = {\n          container: 'map',  //reference to the DOM node that will contain the view\n          map: this.map,  //references the map object created in step 3\n          height: $mapDiv.height(),\n          width: $mapDiv.width()\n        };\n\n        var extent;\n        if (options.coords) {\n          extent = new esri.Extent(options.coords[0][0], options.coords[0][1], options.coords[1][0], options.coords[1][1], new esri.SpatialReference({ wkid: 4326 }));\n        }\n\n        if (extent) {\n          mapViewOpts.extent = extent;\n        } else {\n          mapViewOpts.center = [ -56.049, 38.485 ];\n          mapViewOpts.zoom = 3;\n        }\n\n        this.mapView = new esri.MapView(mapViewOpts);\n\n        //proxy events\n        this.map.on('load', dojo.hitch(this, this.proxyEvent, 'map:load'));\n        this.map.on('extent-change', dojo.hitch(this, this.proxyEvent, 'map:extent-change'));\n        this.map.on('layer-add', dojo.hitch(this, this.proxyEvent, 'map:layer-add'));\n      },\n\n      getDatasetInfoTemplate: function (dataset) {\n        var displayFieldName = dataset.get('displayField');\n        var title = displayFieldName ? '{' + displayFieldName + '}' : 'Attributes';\n        return new esri.PopupTemplate({ title: title, description: '{*}' });\n      },\n\n      getDatasetLayerOpts: function (dataset) {\n        var opts = {\n          minScale: 0,\n          maxScale: 0,\n          outFields: ['*'],\n          popupTemplate: this.getDatasetInfoTemplate(dataset),\n          renderer: this.getRenderer(dataset)\n        };\n        \n        return opts;\n      },\n\n      addDataset: function (dataset) {\n        var opts = this.getDatasetLayerOpts(dataset);\n        this.datasetLayer = new esri.FeatureLayer(dataset.get('url'), opts);\n\n        //proxy events\n        this.datasetLayer.on('load', dojo.hitch(this, this.proxyEvent, 'map:datasetlayer:load'));\n        this.datasetLayer.on('click', dojo.hitch(this, this.proxyEvent, 'map:datasetlayer:click'));\n        this.datasetLayer.on('query-limit-exceeded', dojo.hitch(this, this.proxyEvent, 'map:datasetlayer:query-limit-exceeded'));\n        this.datasetLayer.on('update-end', dojo.hitch(this, this.proxyEvent, 'map:datasetlayer:update-end'));\n\n        this.map.add(this.datasetLayer);\n      },\n\n      /**\n       * Append in default layer styling by adding/updateing \n       * layerOptions.layerDefinition.drawingInfo and setting it's properties\n       * as though it was set from webmap.\n       * @param {Object} layerOptions Json hash of layer properties. Either from a webmap\n       * or constructed for a layer in a feature service\n       */\n      getRenderer: function(dataset){\n          var geometryType = dataset.get('geometryType');\n          var renderer;\n\n          switch (geometryType){\n              case 'esriGeometryPolygon':\n                  renderer = this._createRendererFromJson(util.defaults.defaultPolygonRenderer);\n                  break;\n              case 'esriGeometryPoint':\n                  renderer = this._createRendererFromJson(util.defaults.defaultPointRenderer);\n                  break;\n              case 'esriGeometryMultipoint':\n                  renderer = this._createRendererFromJson(util.defaults.defaultPointRenderer);\n                  break;\n              case 'esriGeometryPolyline':\n                  renderer = this._createRendererFromJson(util.defaults.defaultLineRenderer);\n                  break;\n              case 'esriGeometryLine':\n                  renderer = this._createRendererFromJson(util.defaults.defaultLineRenderer);\n                  break;\n              default: \n                  renderer = this._createRendererFromJson(util.defaults.defaultPolygonRenderer);\n          }\n\n          return renderer;\n      },\n\n      _createRendererFromJson: function(rendererJson){\n          return new esri.SimpleRenderer(rendererJson);\n      }\n\n      \n    });\n\n  });\n})();\n\nif (!this.util || typeof this.util !== 'object') {\n    this.util = {};\n}\n\nutil.defaults = {\n\n  extent:  {\n    'xmin': -24140227.55632808,\n    'ymin': 2529400.5847910205,\n    'xmax': 13430100.586391762,\n    'ymax': 8399764.357090997,\n    'spatialReference': {\n      'wkid': 102100\n    }\n  },\n\n  serviceUrls: {\n    'geometryService': { \n      'url': 'http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer' \n    }\n  },\n  /**\n   * Default Point Renderer for Composer\n   * @return {Object} Json Renderer\n   */   \n  defaultPointRenderer : {\n    'type': 'simple',\n    'label': '',\n    'description': '',\n    'symbol': {\n      'color': [49,130,189,225],\n      'size': 6,\n      'angle': 0,\n      'xoffset': 0,\n      'yoffset': 0,\n      'type': 'esriSMS',\n      'style': 'esriSMSCircle',\n      'outline': {\n        'color': [220,220,220,255],\n        'width': 0.6,\n        'type': 'esriSLS',\n        'style': 'esriSLSSolid'\n      }\n    }\n  },\n\n  /**\n   * Default Line Renderer for Composer\n   * @return {Object} Json Renderer\n   */\n  defaultLineRenderer :  {\n    'type': 'simple',\n    'symbol': {\n      'color': [0,122,194,255],\n      'width': 2,\n      'type': 'esriSLS',\n      'style': 'esriSLSSolid'\n    }\n  },\n\n  /**\n   * Default Polygon Renderer for Composer\n   * @return {Object} Json Renderer\n   */\n  defaultPolygonRenderer :{\n    'type': 'simple',\n    'symbol': {\n      'color': [49,130,189,225],\n      'outline': {\n        'color': [220,220,220,255],\n        'width': 0.6,\n        'type': 'esriSLS',\n        'style': 'esriSLSSolid'\n      },\n      'type': 'esriSFS',\n      'style': 'esriSFSSolid'\n    }\n  }\n};\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('Base', function (Base, App, Backbone, Marionette, $, _) {\n\n    Base.SearchView = Marionette.ItemView.extend({ \n\n      onRender: function(){\n        this.initTypeahead();\n      },\n\n      initTypeahead: function () {\n        var self = this;\n\n        var opts = {\n          highlight: true,\n          minLength: 3,\n          hint: false\n        };\n\n        //by putting it on app instead of this base view, we can share one instance throughout the app\n        //instead of having one instance per view that needs one\n        var bloodhound = App.getBloodhound();\n        bloodhound.initialize();\n\n        var datasets = {\n          name: 'datasets',\n          displayKey: function(item) {\n            return item;\n          },\n          templates: {\n            empty: ''\n          },\n          source: bloodhound.ttAdapter()\n        };\n\n        this.ui.search.typeahead(opts, datasets);\n      },\n\n      onTypeaheadSelected: function (e) {\n        //clicking a selection with the mouse should initiate a search  \n        this.model.set({\n          q: this.ui.search.typeahead('val'),\n          page: 1\n        });\n\n        this.search();\n      },\n\n      updateModel: function () {\n        var q = this.ui.search.typeahead('val');\n        this.model.set({\n          q: q,\n          page: 1\n        });\n      },\n\n      onKeyDown:function(e){\n        if (e.which === 13) {\n          e.preventDefault();\n\n          this.ui.search.typeahead('close');\n\n          this.updateModel();\n\n          this.search();\n        }\n      },\n\n      onKeyUp: function () {\n        this.updateModel();\n      },\n\n      onSearchButtonClick: function () {\n        this.updateModel();\n        this.search();\n      },\n\n      search: function () {\n        App.search();\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n\n  MyOD.module('Models', function (Models, App, Backbone, Marionette, $, _) {\n\n    /*\n    * Models search parameters and uses them to generate search urls\n    */\n    Models.SearchModel = Backbone.Model.extend({\n\n      defaults: {\n        q: '',\n        page: 1,\n        per_page: 20,\n        totalCount: 0\n      },\n\n      queryStringParams: [ 'q', 'page', 'per_page', 'sort_by' ],\n\n      getQueryString: function () {\n        //create an object containing only the attributes we need to generate the querystring\n        var obj = _.pick(this.toJSON(), this.queryStringParams);\n\n        //map it to the format that apiv2 expects\n        obj.page = {\n          number: obj.page,\n          size: obj.per_page\n        };\n        delete obj.per_page;\n\n        //generate querystring parameters from the object\n        return $.param(obj);\n      },\n\n      getRoute: function () {\n        // we use this function to generate routes within the app\n        // AND to generate api urls\n\n        var route = 'datasets';\n        //route += (api) ? '.json?' : '?';\n        route += '?' + this.getQueryString();\n        return route;\n      },\n\n      getUrl: function () {\n        return App.config.api + this.getRoute();\n      }\n\n    });\n\n  });\n\n})();\n\nMyOD.config = {\n  //api: '//umb.dcdev.opendata.arcgis.com/'\n  //api: '//data3.dc.opendataqa.arcgis.com/'\n  //api: '//umb.dcdev.staging.datacommunity.io/'\n  //api: '//clt.charlotte.opendata.arcgis.com/'\n  api: 'https://opendataqa.arcgis.com/api/v2/'\n};\n\nthis.JST = {\"datasets/templates/dataset\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<div class=\"clearfix\">\\n  <h2 class=\"pull-left clearfix\"><img class=\"img-thumbnail\" src=\"' +\n((__t = ( thumbnailSrc )) == null ? '' : __t) +\n'\"><span>' +\n((__t = ( name )) == null ? '' : __t) +\n'</span></h2>\\n  <div class=\"dropdown pull-right\">\\n    <button class=\"btn btn-primary\" type=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\\n      Download\\n      <span class=\"caret\"></span>\\n    </button>\\n    <ul class=\"dropdown-menu\" role=\"menu\" aria-labelledby=\"dLabel\">\\n      <li><a href=\"' +\n((__t = ( baseUrl )) == null ? '' : __t) +\n'.csv\" target=\"_blank\" download>Spreadsheet</a></li>\\n      <li><a href=\"' +\n((__t = ( baseUrl )) == null ? '' : __t) +\n'.kml\" target=\"_blank\" download>KML</a></li>\\n      <li><a href=\"' +\n((__t = ( baseUrl )) == null ? '' : __t) +\n'.zip\" target=\"_blank\" download>Shapefile</a></li>\\n      <li class=\"divider\"></li>\\n      <li><a href=\"' +\n((__t = ( landingPage )) == null ? '' : __t) +\n'\" target=\"_blank\">View in ArcGIS Online</a></li>\\n      <li><a href=\"' +\n((__t = ( url )) == null ? '' : __t) +\n'\" target=\"_blank\">API</a></li>\\n    </ul>\\n  </div>\\n</div>\\n\\n<div class=\"container\">\\n  <div class=\"row\">\\n    <div class=\"col-lg-6 col-md-6\">\\n      <h4>Description</h4>\\n      <p>' +\n((__t = ( description )) == null ? '' : __t) +\n'</p>\\n\\n    </div>\\n    <div class=\"col-lg-6 col-md-6\">\\n      <dl class=\"dl-horizontal\">\\n\\n        <dt>Owner:</dt>\\n        <dd>' +\n((__t = ( owner )) == null ? '' : __t) +\n'</dd>\\n\\n        <dt>Created:</dt>\\n        <dd>' +\n((__t = ( moment(createdAt).calendar() )) == null ? '' : __t) +\n'</dd>\\n\\n        <dt>Updated:</dt>\\n        <dd>' +\n((__t = ( moment(updatedAt).calendar() )) == null ? '' : __t) +\n'</dd>\\n\\n        <dt>Tags:</dt>\\n        <dd>' +\n((__t = ( tags.join(' | ') )) == null ? '' : __t) +\n'</dd>\\n\\n        <dt>Views:</dt>\\n        <dd>' +\n((__t = ( views )) == null ? '' : __t) +\n'</dd>\\n\\n      </dl>\\n    </div>\\n\\n\\n  </div>\\n</div>\\n\\n\\n<div class=\"container\">\\n  <div id=\"map\"></div>\\n  <div id=\"smaps\">\\n    <div class=\"container\"></div>\\n  </div>\\n</div>\\n\\n<div id=\"table-container\" class=\"container\"></div>\\n';\n\n}\nreturn __p\n},\n\"datasets/templates/table-row\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape, __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\nwith (obj) {\n\n _.each(fields, function (field) { ;\n__p += '\\n  <td>' +\n((__t = ( attributes[field.name] )) == null ? '' : __t) +\n'</td>\\n';\n }); ;\n__p += '\\n';\n\n}\nreturn __p\n},\n\"datasets/templates/table\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape, __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\nwith (obj) {\n__p += '<h4>Showing ' +\n((__t = ( from.toLocaleString() )) == null ? '' : __t) +\n' to ' +\n((__t = ( to.toLocaleString() )) == null ? '' : __t) +\n' of ' +\n((__t = ( total.toLocaleString() )) == null ? '' : __t) +\n'</h4>\\n<div class=\"table-responsive\">  \\n  <table class=\"table table-striped table-bordered table-hover\">\\n    <thead>\\n      <tr>\\n        ';\n _.each(fields, function (field) { ;\n__p += '\\n          ';\n if (sortField === field.name) { ;\n__p += '\\n            <th data-field-name=\"' +\n((__t = ( field.name )) == null ? '' : __t) +\n'\" class=\"' +\n((__t = ( sortClass )) == null ? '' : __t) +\n'\">\\n              ' +\n((__t = ( field.alias || field.name )) == null ? '' : __t) +\n'\\n              <span class=\"glyphicon small ' +\n((__t = ( sortIconClass )) == null ? '' : __t) +\n' text-muted\" aria-hidden=\"true\"></span>\\n            </th>\\n          ';\n } else { ;\n__p += '\\n            <th data-field-name=\"' +\n((__t = ( field.name )) == null ? '' : __t) +\n'\">\\n              ' +\n((__t = ( field.alias || field.name )) == null ? '' : __t) +\n'\\n            </th>\\n          ';\n } ;\n__p += '\\n        ';\n }); ;\n__p += '\\n      </tr>\\n    </thead>\\n    <tbody></tbody>\\n  </table>\\n</div>\\n<nav>\\n  <ul class=\"pagination\">\\n    ';\n if (pages.length > 1) { ;\n__p += '\\n      <li id=\"page-prev\" class=\"' +\n((__t = ( firstPage )) == null ? '' : __t) +\n'\"><a data-page=\"' +\n((__t = ( prevPage )) == null ? '' : __t) +\n'\"><span aria-hidden=\"true\">&laquo;</span></a></li>\\n      \\n      ';\n _.each(pages, function (page) { ;\n__p += '\\n        <li class=\"' +\n((__t = ( page.active )) == null ? '' : __t) +\n'\"><a class=\"page-number\" data-page=\"' +\n((__t = ( page.page )) == null ? '' : __t) +\n'\">' +\n((__t = ( page.page )) == null ? '' : __t) +\n'</a></li>\\n      ';\n }); ;\n__p += '\\n\\n      <li id=\"page-next\" class=\"' +\n((__t = ( lastPage )) == null ? '' : __t) +\n'\"><a data-page=\"' +\n((__t = ( nextPage )) == null ? '' : __t) +\n'\"><span aria-hidden=\"true\">&raquo;</span></a></li>\\n    ';\n } ;\n__p += '\\n  </ul>\\n</nav>';\n\n}\nreturn __p\n},\n\"error/templates/404\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<div class=\"alert alert-danger\" role=\"alert\">\\n  <h2>The page you are looking for doesn\\'t exist.</h2>\\n</div>\\n';\n\n}\nreturn __p\n},\n\"error/templates/500\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<div class=\"alert alert-danger\" role=\"alert\">\\n  <h2>An error ocurred.</h2>\\n</div>\\n';\n\n}\nreturn __p\n},\n\"home/templates/home\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '\\n<div class=\"jumbotron\" id=\"hero\">\\n  <h1 class=\"page-header\">My Open Data</h1>\\n  <p>\\n    <div class=\"input-group input-group-lg\">\\n      <label class=\"sr-only\" for=\"search\">Search</label>\\n      <input type=\"search\" name=\"search\" id=\"search\" class=\"form-control\" placeholder=\"search for open data\">\\n      <span class=\"input-group-btn\">\\n        <button id=\"search-btn\" class=\"btn btn-default\" type=\"button\">\\n          <span class=\"glyphicon glyphicon-search\" aria-hidden=\"true\"></span>\\n        </button>\\n      </span>\\n    </div>\\n  </p>\\n  <span style=\"float:right;color:#FFF\">Image <a href=\"https://www.flickr.com/photos/davebloggs007/14389618573\">CC Dave Bloggs</a></span>\\n</div>\\n<div class=\"row\">\\n  \\n</div>\\n';\n\n}\nreturn __p\n},\n\"results/templates/results-empty\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<td colspan=\"7\" class=\"text-center\">...</td>';\n\n}\nreturn __p\n},\n\"results/templates/results-item\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<td>' +\n((__t = ( name )) == null ? '' : __t) +\n'</td>\\n<td>' +\n((__t = ( owner )) == null ? '' : __t) +\n'</td>\\n<td>' +\n((__t = ( recordCount )) == null ? '' : __t) +\n'</td>\\n<td>' +\n((__t = ( itemType )) == null ? '' : __t) +\n'</td>\\n<td>' +\n((__t = ( views )) == null ? '' : __t) +\n'</td>\\n<td>' +\n((__t = ( moment(createdAt).fromNow() )) == null ? '' : __t) +\n'</td>\\n<td>' +\n((__t = ( moment(updatedAt).fromNow() )) == null ? '' : __t) +\n'</td>\\n';\n\n}\nreturn __p\n},\n\"results/templates/results-loading\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape;\nwith (obj) {\n__p += '<td colspan=\"7\" class=\"text-center\">\\n  <div class=\"progress\">\\n    <div class=\"progress-bar progress-bar-striped active\" role=\"progressbar\" aria-valuenow=\"40\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: 45%\">\\n      <span class=\"sr-only\">45% Complete</span>\\n    </div>\\n  </div>\\n</td>';\n\n}\nreturn __p\n},\n\"results/templates/results\": function(obj) {\nobj || (obj = {});\nvar __t, __p = '', __e = _.escape, __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\nwith (obj) {\n__p += '<h2>\\n  ';\n if (!collectionIsLoading) { ;\n__p += '\\n    Your search for <em>\"' +\n((__t = ( q )) == null ? '' : __t) +\n'\"</em> yielded ' +\n((__t = ( totalCount.toLocaleString() )) == null ? '' : __t) +\n' datasets\\n  ';\n } ;\n__p += '\\n</h2>\\n\\n<div class=\"table-responsive\">\\n  <table class=\"table table-striped table-bordered table-hover\">\\n    <thead>\\n      <tr>\\n        <th>NAME</th>\\n        <th>OWNER</th>\\n        <th>RECORDS</th>\\n        <th>LAYER TYPE</th>\\n        <th>VIEWS</th>\\n        <th>CREATED</th>\\n        <th>UPDATED</th>\\n      </tr>\\n    </thead>\\n    <tbody></tbody>\\n  </table>\\n</div>\\n<nav>\\n  <ul class=\"pagination\">\\n    ';\n if (pages.length > 1) { ;\n__p += '\\n      <li id=\"page-prev\" class=\"' +\n((__t = ( firstPage )) == null ? '' : __t) +\n'\"><a href=\"#' +\n((__t = ( prevUrl )) == null ? '' : __t) +\n'\" data-page=\"' +\n((__t = ( prevPage )) == null ? '' : __t) +\n'\"><span aria-hidden=\"true\">&laquo;</span></a></li>\\n\\n      ';\n _.each(pages, function (page) { ;\n__p += '\\n        <li class=\"' +\n((__t = ( page.active )) == null ? '' : __t) +\n'\"><a href=\"#' +\n((__t = ( page.url )) == null ? '' : __t) +\n'\" class=\"page-number\" data-page=\"' +\n((__t = ( page.page )) == null ? '' : __t) +\n'\">' +\n((__t = ( page.page )) == null ? '' : __t) +\n'</a></li>\\n      ';\n }); ;\n__p += '\\n\\n      <li id=\"page-next\" class=\"' +\n((__t = ( lastPage )) == null ? '' : __t) +\n'\"><a href=\"#' +\n((__t = ( nextUrl )) == null ? '' : __t) +\n'\" data-page=\"' +\n((__t = ( nextPage )) == null ? '' : __t) +\n'\"><span aria-hidden=\"true\">&raquo;</span></a></li>\\n    ';\n } ;\n__p += '\\n  </ul>\\n</nav>\\n';\n\n}\nreturn __p\n}};\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('Main', function (Main, App, Backbone, Marionette, $, _) {\n          \n    Main.HeaderSearchView = MyOD.Base.SearchView.extend({ \n\n      initialize: function () {\n        this.listenTo(this.model, 'change:q', this.onQueryChanged);\n      },\n\n      el: '#header-search-container',\n\n      template: false,\n\n      events: {\n        'keydown #header-search': 'onKeyDown',\n        'keyup #header-search': 'onKeyUp',\n        'click #header-search-btn': 'onSearchButtonClick',\n        'typeahead:selected input': 'onTypeaheadSelected'\n      },\n\n      ui: {\n        search: '#header-search'\n      },\n\n      onQueryChanged: function () {\n        this.ui.search.typeahead('val', this.model.get('q'));\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('Main', function (Main, App, Backbone, Marionette, $, _) {\n\n    Main.Layout = Marionette.LayoutView.extend({\n      \n      initialize: function () {\n        _.bindAll(this, 'setClasses');\n        this.headerSearchView = new Main.HeaderSearchView({ model: App.searchModel }).render();\n      },\n\n      el: 'body',\n\n      regions: {\n        main: '#main-region'\n      },\n\n      events: {\n        'click #home-link': 'navigateHome'\n      },\n\n      navigateHome: function (e) {\n        if (!e.metaKey && !e.ctrlKey) {\n          e.preventDefault();\n          App.navigate('', { trigger: true });\n        }\n      },\n\n      setClasses: function () {\n        var self = this;\n        if (Backbone.history.getFragment().indexOf('datasets') === 0) {\n          self.$el.removeClass('page-home');\n        } else {\n          self.$el.addClass('page-home');\n        }\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('HomeModule', function (HomeModule, App, Backbone, Marionette, $, _) {\n          \n    HomeModule.View = MyOD.Base.SearchView.extend({ \n\n      initialize: function () {\n        this.model = App.searchModel;   \n      },\n\n      template: JST['home/templates/home'],\n\n      events: {\n        'keydown #search': 'onKeyDown',\n        'keyup #search': 'onKeyUp',\n        'click #search-btn': 'onSearchButtonClick',\n        'typeahead:selected input': 'onTypeaheadSelected'\n      },\n\n      ui: {\n        search: '#search'\n      },\n\n      id: 'home',\n\n      onDomRefresh: function () {\n        this.ui.search.focus();\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('HomeModule', function (HomeModule, App, Backbone, Marionette, $, _) {\n          \n    HomeModule.Controller = Marionette.Controller.extend({ \n\n      initUi: function () {\n        var view = new HomeModule.View();\n        App.layout.getRegion('main').show(view);\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n    \n  'use strict';\n\n  MyOD.module('HomeModule', function (HomeModule, App, Backbone, Marionette, $, _) {\n      \n    //Router for the module\n    HomeModule.Router = Backbone.Marionette.AppRouter.extend({\n      appRoutes:{\n        '': 'show'\n      }\n    });\n\n    //Add the router during the initialization \n    HomeModule.addInitializer(function (options) {\n      var router = new HomeModule.Router({ controller: HomeModule.API }); \n    });\n\n    //Simple API object that provides the implementation for the routes\n    HomeModule.API = {\n\n      show: function(options){\n\n        if(!this.homeController){\n          this.homeController = new HomeModule.Controller(options);\n        }\n\n        this.homeController.initUi(options);\n      }\n    };\n\n  });\n})();\n\n(function () {\n\n  'use strict';\n\n  MyOD.module('Models', function (Models, App, Backbone, Marionette, $, _) {\n\n    /*\n    * Models a dataset\n    */\n    Models.DatasetModel = Backbone.Model.extend({\n\n      defaults: {\n        id: '',\n        name: '',\n        description: '',\n        tags: [],\n        landingPage: '',\n        recordCount: '',\n        itemType: '',\n        owner: '',\n        url: '',\n        createdAt: '',\n        updatedAt: '',\n        views: 0,\n        thumbnailUrl: ''\n      },\n\n      parse: function (response) {\n        // map it from jsonapi back to what backbone expects\n        var resp = response.data || response;\n        return _.extend({id: resp.id}, resp.attributes);\n      },\n\n      url: function () {\n        return MyOD.config.api + 'datasets/' + this.get('id');\n      },\n\n      getNumericFields: function () {\n        var fields = this.get('fields');\n        return _.filter(fields, function (item) {\n          return _.contains([ 'esriFieldTypeSingle', 'esriFieldTypeDouble', 'esriFieldTypeInteger' ], item.type);\n        });\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n\n  MyOD.module('Models', function (Models, App, Backbone, Marionette, $, _) {\n\n    /*\n    * Models a collection of datasets\n    */\n    Models.DatasetCollection = Backbone.Collection.extend({\n\n      model: Models.DatasetModel,\n\n      url: function () {\n        return App.searchModel.getUrl();\n      },\n\n      parse: function (resp) {\n        //apply the metadata to the searchmodel\n        var obj = {\n          page: resp.meta.queryParameters.page.number,\n          per_page: resp.meta.queryParameters.page.size\n        };\n        App.searchModel.set(_.extend(obj, resp.meta.stats));\n\n        return resp.data;\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n\n  MyOD.module('ResultsModule', function (ResultsModule, App, Backbone, Marionette, $, _) {\n\n    ResultsModule.ItemView = Marionette.ItemView.extend({\n\n      template: JST['results/templates/results-item'],\n\n      model: MyOD.Models.DatasetModel,\n\n      tagName: 'tr',\n\n      events: {\n        click: 'onClick'\n      },\n\n      onClick: function () {\n        this.trigger('result:clicked', this.model);\n      }\n\n    });\n\n    ResultsModule.LoadingView = Marionette.ItemView.extend({\n\n      template: JST['results/templates/results-loading'],\n\n      tagName: 'tr',\n\n      className: 'loading'\n\n    });\n\n    ResultsModule.EmptyView = Marionette.ItemView.extend({\n\n      template: JST['results/templates/results-empty'],\n\n      tagName: 'tr'\n\n    });\n\n    ResultsModule.View = Marionette.CompositeView.extend({\n\n      initialize: function () {\n        this.listenTo(this, 'childview:result:clicked', this.selectDataset);\n      },\n\n      collectionIsLoading: true,\n\n      template: JST['results/templates/results'],\n\n      childView: ResultsModule.ItemView,\n\n      childViewContainer: 'tbody',\n\n      getEmptyView: function () {\n        if (this.collectionIsLoading) {\n          return ResultsModule.LoadingView;\n        } else {\n          return ResultsModule.EmptyView;\n        }\n      },\n\n      events: {\n        'click ul.pagination a': 'onPageClicked'\n      },\n\n      modelEvents: {\n        'change:totalCount': 'render'\n      },\n\n      collectionEvents: {\n        'sync': 'onCollectionSync',\n        'error': 'onCollectionSync'\n      },\n\n      id: 'page-results',\n\n      onCollectionSync: function () {\n        this.collectionIsLoading = false;\n        this.render();\n      },\n\n      selectDataset: function (childView, childModel) {\n        App.navigateDataset(childModel.get('id'));\n      },\n\n      onPageClicked: function (e) {\n        //allow cmd-click to open in new window\n        if(!(e.metaKey || e.ctrlKey)){\n          e.stopPropagation();\n          e.preventDefault();\n          var page = $(e.target).closest('a').data('page');\n          //not sure why i was doing it this way...\n          //var model = App.searchModel.clone();\n          //App.navigate(model.getRoute(false), { trigger: true });\n          this.model.set('page', page);\n          App.search();\n        }\n      },\n\n      templateHelpers: function () {\n        //serialize the model into what we need for the template\n        var info = App.searchModel.toJSON();\n\n        var len = Math.round(info.totalCount);\n        var page = +info.page;\n        var from = (page === 0) ? page + 1 : page;\n        var size = info.per_page;\n        var total_pages = Math.ceil(len / size);\n        var pages = [];\n\n        //don't show more than 10?\n        var start = ( total_pages > 10 && from > 6 ) ? from - 5 : 1;\n        var end = ( total_pages > start + 9 ) ? start + 9 : total_pages;\n\n        // build the pages array\n        var searchModel = this.model.clone();\n        var active;\n        for (var i = start; i <= end; i++) {\n          active = (i === from) ? 'active' : '';\n          searchModel.set('page', i);\n          pages.push({ url: searchModel.getRoute(false), page: i, active: active });\n        }\n\n        var prevUrl = this.model.getRoute(false);\n        var prevPage = page;\n        if (from !== 1) {\n          prevPage = page-1;\n          searchModel.set('page', prevPage);\n          prevUrl = searchModel.getUrl();\n        }\n        var nextUrl = this.model.getRoute(false);\n        var nextPage = page;\n        if (total_pages !== from) {\n          nextPage = page + 1;\n          searchModel.set('page', nextPage);\n          nextUrl = searchModel.getUrl();\n        }\n\n        return {\n          firstPage: (from === 1) ? 'disabled' : '',\n          lastPage: (total_pages === from) ? 'disabled' : '',\n          prevUrl: prevUrl,\n          nextUrl: nextUrl,\n          prevPage: prevPage,\n          nextPage: nextPage,\n          pages: pages,\n          collectionIsLoading: this.collectionIsLoading\n        };\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('ResultsModule', function (ResultsModule, App, Backbone, Marionette, $, _) {\n          \n    ResultsModule.Controller = Marionette.Controller.extend({ \n\n      initUi: function (options) {\n        this.collection = new App.Models.DatasetCollection();\n        this.collection.fetch({ cache: true });\n        this.view = new ResultsModule.View({ model: App.searchModel, collection: this.collection });\n        App.layout.getRegion('main').show(this.view);\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n    \n  'use strict';\n\n  MyOD.module('ResultsModule', function (ResultsModule, App, Backbone, Marionette, $, _) {\n      \n    //Router for the module\n    ResultsModule.Router = Backbone.Marionette.AppRouter.extend({\n      appRoutes:{\n        'datasets(/)': 'show'\n      }\n    });\n\n    //Add the router during the initialization \n    ResultsModule.addInitializer(function (options) {\n      var router = new ResultsModule.Router({ controller: ResultsModule.API }); \n    });\n\n    //Simple API object that provides the implementation for the routes\n    ResultsModule.API = {\n\n      show: function(options){\n\n        var queryObj = App.queryStringToObject();\n        //don't encode the q\n        // var q = App.searchModel.get('q');\n        // App.searchModel.set(_.extend(queryObj, { q: q }));\n        App.searchModel.set(queryObj);\n\n        if(!this.resultsController){\n          this.resultsController = new ResultsModule.Controller(options);\n        }\n\n        this.resultsController.initUi(options);\n      }\n\n    };\n\n  });\n})();\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('Models', function (Models, App, Backbone, Marionette, $, _) {\n          \n    /*\n    * Models a single record in a dataset\n    */\n    Models.DatasetRow = Backbone.Model.extend({\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n\n  MyOD.module('Models', function (Models, App, Backbone, Marionette, $, _) {\n\n    /*\n    * Models a collection of records in a dataset\n    */\n    Models.RowCollection = Backbone.Collection.extend({\n\n      initialize: function (attributes, options) {\n        this.dataset = options.dataset;\n\n        var queryCapabilities = this.dataset.get('advancedQueryCapabilities');\n        this.supportsPagination = queryCapabilities && queryCapabilities.supportsPagination;\n\n        this.orderBy = this.dataset.get('objectIdField');\n      },\n\n      perPage: 10,\n\n      page: 0,\n\n      orderBy: '',\n\n      orderByAsc: true,\n\n      model: Models.DatasetRow,\n\n      getQueryUrl: function () {\n        var url = this.dataset.get('url');\n        url += '/query?where=1%3D1&text=&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&relationParam=&outFields=*&returnGeometry=false&maxAllowableOffset=&geometryPrecision=&outSR=&returnIdsOnly=false&returnCountOnly=false&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&returnDistinctValues=false&f=pjson';\n\n        if (this.supportsPagination) {\n          url += '&resultOffset=' + this.page * this.perPage;\n          url += '&resultRecordCount=' + this.perPage;\n          //NOTE: when you pass in one of the above two parameters and orderByFields is left empty,\n          //map service uses the object-id field to sort the result.\n          //For a query layer with a pseudo column as the object-id field (e.g., FID),\n          //you must provide orderByFields; otherwise the query fails\n        }\n\n        var orderBy = this.orderBy;\n        if (!this.orderByAsc) {\n          orderBy += ' desc';\n        }\n        //NOTE: this still could fail\n        //if the oid field has changed since it was harvested by open data\n        //or it is null (which should not happen...)\n        url += '&orderByFields=' + orderBy;\n\n        return url;\n      },\n\n      url: function () {\n        return this.getQueryUrl();\n      },\n\n      parse: function (resp) {\n        // this.fields = resp.fields;\n        // this.fieldAliases = resp.fieldAliases;\n        var rows = resp.features;\n        if (!this.supportsPagination) {\n          //this is slightly crappy but\n          //for datasets that don't support pagination\n          //we just show the first n rows with no pagination\n          //even though we got maxRecordCount rows\n          rows = _.first(rows, this.perPage);\n        }\n        return rows;\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n\n  MyOD.module('DatasetsModule', function (DatasetsModule, App, Backbone, Marionette, $, _) {\n\n    DatasetsModule.TableRowView = Marionette.ItemView.extend({\n\n      initialize: function (options) {\n        this.dataset = options.dataset;\n        this.fields = this.dataset.get('fields');\n      },\n\n      template: JST['datasets/templates/table-row'],\n\n      templateHelpers: function () {\n        var self = this;\n        return {\n          fields: self.fields\n        };\n      },\n\n      model: MyOD.Models.DatasetRow,\n\n      tagName: 'tr'\n\n    });\n\n    DatasetsModule.TableView = Marionette.CompositeView.extend({\n\n      initialize: function (options) {\n        this.collection = new App.Models.RowCollection([], { dataset: this.model });\n        this.collection.fetch();\n      },\n\n      events: {\n        'click ul.pagination li a': 'onPageClicked',\n        'click thead th': 'sort'\n      },\n\n      collectionEvents: {\n        //we need the pagination to re-render\n        'reset': 'render'\n      },\n\n      template: JST['datasets/templates/table'],\n\n      childView: DatasetsModule.TableRowView,\n\n      childViewOptions: function () {\n        var dataset = this.model;\n        return {\n          dataset: dataset\n        };\n      },\n\n      templateHelpers: function () {\n\n        //defaults - this is what will be rendered if the dataset does not support pagination\n        var obj = {\n          firstPage: '',\n          lastPage: '',\n          prevPage: 0,\n          nextPage: 0,\n          pages: [],\n          showPagination: false,\n          from: 1,\n          to: this.collection.perPage,\n          total: this.model.get('recordCount'),\n          sortField: this.collection.orderBy,\n          sortClass: this.collection.orderByAsc ? 'sort_asc' : 'sort_desc',\n          sortIconClass: this.collection.orderByAsc ? 'glyphicon-chevron-down' : 'glyphicon-chevron-up',\n        };\n\n        if (this.collection.supportsPagination) {\n          var totalPages = Math.ceil(this.model.get('recordCount') / this.collection.perPage);\n          //zero based page index\n          var page = this.collection.page;\n\n          //don't show more than 10 pages in paginator?\n          var start = (totalPages > 10 && page > 6) ? page - 5 : 1;\n          var end = (totalPages > start + 9) ? start + 9 : totalPages;\n\n          var active, pages = [];\n          for (var i = start; i <= end; i++) {\n            active = (i === page + 1) ? 'active' : '';\n            pages.push({ page: i, active: active });\n          }\n\n          var total = this.model.get('recordCount');\n          var from = page * this.collection.perPage + 1;\n          var to = page * this.collection.perPage + this.collection.perPage;\n          to = (to <= total) ? to : total;\n\n          obj = {\n            firstPage: (page === 0) ? 'disabled' : '',\n            lastPage: (totalPages === page + 1) ? 'disabled' : '',\n            prevPage: page,\n            nextPage: page + 2,\n            pages: pages,\n            showPagination: true,\n            from: from,\n            to: to,\n            total: total,\n            sortField: this.collection.orderBy,\n            sortClass: this.collection.orderByAsc ? 'sort_asc' : 'sort_desc',\n            sortIconClass: this.collection.orderByAsc ? 'glyphicon-chevron-down' : 'glyphicon-chevron-up',\n          };\n        }\n\n        return obj;\n      },\n\n      childViewContainer: 'tbody',\n\n      onPageClicked: function (e) {\n        var anchor = $(e.target).closest('a');\n        var li = anchor.closest('li');\n        if (!li.hasClass('disabled') && !li.hasClass('active')) {\n          var page = anchor.data('page') - 1;\n          this.collection.page = page;\n          this.collection.fetch({ reset: true });\n        }\n      },\n\n      sort: function (e) {\n        var orderBy = $(e.target).data('fieldName');\n        if (orderBy) {\n          if (orderBy === this.collection.orderBy) {\n            this.collection.orderByAsc = !this.collection.orderByAsc;\n          } else {\n            this.collection.orderByAsc = true;\n          }\n          this.collection.page = 0;\n          this.collection.orderBy = orderBy;\n          this.collection.fetch({ reset: true });\n        }\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n\n  MyOD.module('DatasetsModule', function (DatasetsModule, App, Backbone, Marionette, $, _) {\n\n    DatasetsModule.View = Marionette.ItemView.extend({\n\n      initialize: function (options) {\n        _.bindAll(this, 'changeAttribute', 'changeRamp');\n        this.mapManager = options.mapManager;\n      },\n\n      template: JST['datasets/templates/dataset'],\n\n      id: 'page-dataset',\n\n      ui: {\n        'mapDiv': '#map',\n        'tableContainer': '#table-container'\n      },\n\n      modelEvents: {\n        'change': 'render'\n      },\n\n      templateHelpers: function () {\n        var baseUrl = this.model.url().replace(/.json$/, '').replace('/api/v2', '');\n        var thumbnailUrl = this.model.get('thumbnailUrl');\n        var defaultThumbnailUrl = 'images/default-dataset-thumb.png';\n        return {\n          baseUrl: baseUrl,\n          thumbnailSrc: thumbnailUrl || defaultThumbnailUrl\n        };\n      },\n\n      onRender: function () {\n        //TODO: refactor to use regions...\n        this.tableView = new DatasetsModule.TableView({ el: this.ui.tableContainer, model: this.model }).render();\n      },\n\n      // onShow: function () {\n      //   console.debug('onShow');\n      // },\n\n      onDomRefresh: function () {\n        if (this.model.get('itemType').toLowerCase() !== 'table') {\n          var self = this;\n          // TODO: would be nice to encapsulate this in mapmanager so consumers wouldn't have to know to do it\n          this.ui.mapDiv.show();\n          this.mapManager.dojoReady.done(function () {\n            self.mapManager.createMap('map', { coords: self.model.get('extent').coordinates });\n            self.mapManager.addDataset(self.model);\n\n            //self.initSmaps();\n          });\n        }\n      },\n\n      initSmaps: function (basemap) {\n        var numerics = this.model.getNumericFields();\n\n        if (numerics.length){\n\n          // select the first attr to map\n          // we could put some logic around which to use here\n          this.fieldName = this.fieldName || numerics[0].name;\n\n          //get stats for selected attribute\n          var fields = this.model.get('fields');\n          this.stats = this.getStats(fields, this.fieldName);\n          this.type = this.getGeometryType(this.model.get('geometryType'));\n\n\n          var yukiOptions = {\n            fields: numerics,\n            field: this.fieldName,\n            statistics: this.stats,\n            type: this.type,\n            schemes: this.getSchemes()\n          };\n\n          if (!this.yuki) {\n            this.yuki = new Yuki('smaps', yukiOptions);\n          } else {\n            $('#yuki-viz-tools').remove();\n            this.yuki = new Yuki('smaps', yukiOptions);\n          }\n\n          // EVENT Handlers from yuki\n          this.yuki.on('change', this.changeAttribute);\n          this.yuki.on('ramp-change', this.changeRamp);\n\n          this._execStyleMap();\n        }\n\n      },\n\n      getStats: function (fields, fieldName) {\n        var fieldObj = _.findWhere(fields, { name: fieldName });\n        return fieldObj ? fieldObj.statistics : null;\n      },\n\n      getGeometryType: function (geomType) {\n        switch (geomType) {\n          case 'esriGeometryPoint':\n          case 'esriGeometryMultipoint':\n            return 'point';\n          case 'esriGeometryPolyline':\n            return 'line';\n          case 'esriGeometryPolygon':\n            return 'polygon';\n          default:\n            return geomType.toLowerCase();\n        }\n      },\n\n      getSchemes: function (){\n        var theme, styleType, self = this;\n        switch (this.type){\n          case 'point':\n            theme = 'default';\n            styleType = 'size';\n            break;\n          case 'polygon':\n            theme = 'high-to-low';\n            styleType = 'choropleth';\n            break;\n        }\n\n        //TODO: move this into mapmanager\n        return esri.styles[styleType].getSchemes({\n          theme: theme,\n          basemap: 'dark-gray',\n          geometryType: self.type\n        });\n      },\n\n      // handler for attr change\n      changeAttribute: function (fieldName) {\n        //update stats for selected attribute\n        var fields = this.model.get('fields');\n        this.stats = this.getStats(fields, fieldName);\n        this.fieldName = fieldName;\n\n        this._execStyleMap(this.selectedScheme);\n      },\n\n      // handler for ramp UI change\n      changeRamp: function (index) {\n        this.selectedScheme = this.getSchemes().secondarySchemes[index];\n        this._execStyleMap(this.selectedScheme);\n      },\n\n      //update the map in mapmanager\n      _execStyleMap: function (scheme) {\n        var self = this;\n\n        var opts = {\n          field: this.fieldName,\n          basemap: 'dark-gray',\n          statistics: this.stats,\n          type: this.type\n        };\n\n        if (scheme){\n          opts.scheme = scheme;\n        }\n\n        var foo = App.reqres.request('smaps:update:style', opts)\n          .done(function(renderer){\n            if (self.type === 'point'){\n              self.yuki.buildPointLegend(renderer.breaks);\n            }\n          });\n      },\n\n      onDestroy: function () {\n        this.mapManager.destroy();\n        this.tableView.destroy();\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('DatasetsModule', function (DatasetsModule, App, Backbone, Marionette, $, _) {\n\n    DatasetsModule.Controller = Marionette.Controller.extend({ \n\n      initialize: function () {\n        _.bindAll(this, 'onModelFetched');\n      },\n\n      initUi: function (options) {\n        this.mapManager = new App.Utils.MapManager();\n        this.model = new App.Models.DatasetModel({ id: options });\n        this.model\n          .fetch()\n            .done(this.onModelFetched)\n            .fail(function () {\n              App.navigate404();\n            });\n      },\n\n      onModelFetched: function () {\n        var view = new DatasetsModule.View({ model: this.model, mapManager: this.mapManager });\n        App.layout.getRegion('main').show(view);\n      },\n\n      onBeforeDestroy: function () {\n        if (this.mapManager) {\n          this.mapManager.destroy();\n        }\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n    \n  'use strict';\n\n  MyOD.module('DatasetsModule', function (DatasetsModule, App, Backbone, Marionette, $, _) {\n      \n    //Router for the module\n    DatasetsModule.Router = Backbone.Marionette.AppRouter.extend({\n      appRoutes:{\n        'datasets/:id(/)': 'show',\n      }\n    });\n\n    //Add the router during the initialization \n    DatasetsModule.addInitializer(function (options) {\n      var router = new DatasetsModule.Router({ controller: DatasetsModule.API }); \n    });\n\n    //Simple API object that provides the implementation for the routes\n    DatasetsModule.API = {\n\n      show: function(options){\n\n        if(!this.datasetsController){\n          this.datasetsController = new DatasetsModule.Controller(options);\n        }\n\n        this.datasetsController.initUi(options);\n      }\n    };\n\n  });\n})();\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('ErrorModule', function (ErrorModule, App, Backbone, Marionette, $, _) {\n          \n    ErrorModule.View = Marionette.ItemView.extend({\n      \n      id: 'page-error',\n\n      getTemplate: function(){\n        var errorCode = this.model.get('errorCode');\n        var template;\n\n        switch (errorCode) {\n          case 404:\n            template = JST['error/templates/404'];\n            break;\n          default:\n            template = JST['error/templates/500'];\n        }\n\n        return template;\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n\n  'use strict';\n    \n  MyOD.module('ErrorModule', function (ErrorModule, App, Backbone, Marionette, $, _) {\n\n    ErrorModule.Controller = Marionette.Controller.extend({ \n\n      initUi: function (options) {\n        // init the results view in here so it re-binds on \"back button\"\n        var model = new Backbone.Model({ errorCode: options.errorCode });\n        var view = new ErrorModule.View({ model: model });\n\n        App.layout.getRegion('main').show(view);\n      }\n\n    });\n\n  });\n\n})();\n\n\n(function () {\n    \n  'use strict';\n\n  MyOD.module('ErrorModule', function (ErrorModule, App, Backbone, Marionette, $, _) {\n      \n    //Router for the module\n    ErrorModule.Router = Backbone.Marionette.AppRouter.extend({\n      appRoutes:{\n        '404': 'error404',\n        '500': 'error500'\n      }\n    });\n\n    //Add the router during the initialization \n    ErrorModule.addInitializer(function (options) {\n      var router = new ErrorModule.Router({ controller: ErrorModule.API }); \n    });\n\n    //Simple API object that provides the implementation for the routes\n    ErrorModule.API = {\n\n      initController: function () {\n        if(!this.errorController){\n          this.errorController = new ErrorModule.Controller();\n        }\n      },\n\n      error404: function () {\n        this.initController();\n        this.errorController.initUi({ errorCode: 404 });\n      },\n\n      error500: function () {\n        this.initController();\n        this.errorController.initUi({ errorCode: 500 });\n      }\n    };\n\n  });\n})();\n\n$(function () {\n  'use strict';\n\n  MyOD.start();\n});"],"sourceRoot":"/source/"}